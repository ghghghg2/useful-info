<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Understanding Atomics and Memory Ordering - DEV Community</title>
      <meta name="last-updated" content="2023-11-24 09:16:46 UTC">
      <meta name="user-signed-in" content="false">
      <meta name="head-cached-at" content="1700817406">
        <!-- Experimental web monetization payment pointer for micropayments -->
        <!-- It lets readers make micropayments to websites they visit. -->
        <!-- This is step 1: Get live in production to test for platform-wide payment pointer. -->
        <!-- Step 2: Allow authors to set their payment pointer so they can directly monetize their content based on visitors. -->
        <!-- Step 3: Enable further functionality based on what we learn from this experimentation and how the ecosystem evolves. -->
        <meta name="monetization" content="$ilp.uphold.com/24HhrUGG7ekn">
      <meta name="environment" content="production">
      <link rel="stylesheet" href="https://dev.to/assets/minimal-ce2284f1c9b04ffc034a5682b214006dda88306116e7a895eb23278e96ed1309.css" media="all" id="main-minimal-stylesheet" />
<link rel="stylesheet" href="https://dev.to/assets/views-b907f8120ea7d1917d7944d3b143e08b50dab5c29d611ef5bdcfb492922927f0.css" media="all" id="main-views-stylesheet" />
<link rel="stylesheet" href="https://dev.to/assets/crayons-fc1f3330b6564e7c586aaa6cddad1a5a5b5b5f962e32983114ba56cf220183a0.css" media="all" id="main-crayons-stylesheet" />

      <script src="https://dev.to/assets/base-c950c3d8675a0768090c99e2ed3a8f882eb646e452cd4e8053ca27b312b2e7bb.js" defer="defer"></script>
        <script src="https://dev.to/packs/js/runtime~base-25ca70cb814787506263.js" defer="defer"></script>
<script src="https://dev.to/packs/js/base-438b3a984b9894850daa.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/runtime~baseInitializers-ab35cf6b652fab331674.js" defer="defer"></script>
<script src="https://dev.to/packs/js/baseInitializers-37ac616b12f2c877503a.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/runtime~Search-44b1637788d4365b9f67.js" defer="defer"></script>
<script src="https://dev.to/packs/js/0-6a8935ca6bc68cd25de7.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/1-b4e73c43b525ea3bbdf5.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/Search-caf4d4d2ac5b6ed6f31b.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/runtime~runtimeBanner-8b3e3883b8eb58f989fb.js" defer="defer"></script>
<script src="https://dev.to/packs/js/runtimeBanner-bc74d3157c67910d8d00.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/runtime~baseTracking-0e19fe5d7159285c6fab.js" defer="defer"></script>
<script src="https://dev.to/packs/js/baseTracking-f53ebd72375020aee44b.chunk.js" defer="defer"></script>
      
    <link rel="canonical" href="https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom" />
    <meta name="description" content="Atomics and Memory Ordering always feel like an unapproachable topic. In the sea of poor explanations... Tagged with cpp, atomic, llvm, optimization.">
    <meta name="keywords" content="cpp, atomic, llvm, optimization, software, coding, development, engineering, inclusive, community">

    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom" />
    <meta property="og:title" content="Understanding Atomics and Memory Ordering" />
    <meta property="og:description" content="Atomics and Memory Ordering always feel like an unapproachable topic. In the sea of poor explanations..." />
    <meta property="og:site_name" content="DEV Community" />
    <meta name="twitter:site" content="@thepracticaldev">
    <meta name="twitter:creator" content="@">
    <meta name="twitter:title" content="Understanding Atomics and Memory Ordering">
    <meta name="twitter:description" content="Atomics and Memory Ordering always feel like an unapproachable topic. In the sea of poor explanations...">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:widgets:new-embed-design" content="on">
    <meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1">
      <meta property="og:image" content="https://dev.to/social_previews/article/659466.png" />
      <meta name="twitter:image:src" content="https://dev.to/social_previews/article/659466.png">

      <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
      <link rel="icon" type="image/x-icon" href="https://res.cloudinary.com/practicaldev/image/fetch/s--E8ak4Hr1--/c_limit,f_auto,fl_progressive,q_auto,w_32/https://dev-to.s3.us-east-2.amazonaws.com/favicon.ico" />
      <link rel="apple-touch-icon" href="https://res.cloudinary.com/practicaldev/image/fetch/s--eWZ6RXEZ--/c_limit,f_png,fl_progressive,q_80,w_180/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8j7kvp660rqzt99zui8e.png">
      <link rel="apple-touch-icon" sizes="152x152" href="https://res.cloudinary.com/practicaldev/image/fetch/s--4NZquTNJ--/c_limit,f_png,fl_progressive,q_80,w_152/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8j7kvp660rqzt99zui8e.png">
      <link rel="apple-touch-icon" sizes="180x180" href="https://res.cloudinary.com/practicaldev/image/fetch/s--eWZ6RXEZ--/c_limit,f_png,fl_progressive,q_80,w_180/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8j7kvp660rqzt99zui8e.png">
      <link rel="apple-touch-icon" sizes="167x167" href="https://res.cloudinary.com/practicaldev/image/fetch/s--2M4UHURL--/c_limit,f_png,fl_progressive,q_80,w_167/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8j7kvp660rqzt99zui8e.png">
      <link href="https://res.cloudinary.com/practicaldev/image/fetch/s--b551aYX---/c_limit,f_png,fl_progressive,q_80,w_192/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8j7kvp660rqzt99zui8e.png" rel="icon" sizes="192x192" />
      <link href="https://res.cloudinary.com/practicaldev/image/fetch/s--NWcX-tD4--/c_limit,f_png,fl_progressive,q_80,w_128/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8j7kvp660rqzt99zui8e.png" rel="icon" sizes="128x128" />
      <meta name="apple-mobile-web-app-title" content="dev.to">
      <meta name="application-name" content="dev.to">
      <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
      <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">
      <link rel="search" href="https://dev.to/open-search.xml" type="application/opensearchdescription+xml" title="DEV Community" />

      <meta property="forem:name" content="DEV Community" />
      <meta property="forem:logo" content="https://res.cloudinary.com/practicaldev/image/fetch/s--BlMrNwoZ--/c_limit,f_png,fl_progressive,q_80,w_512/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8j7kvp660rqzt99zui8e.png" />
      <meta property="forem:domain" content="dev.to" />
  </head>
      <body
        class="sans-serif-article-body default-header"
        data-user-status="logged-out"
        data-community-name="DEV Community"
        data-locale="en"
        data-honeybadger-key="hbp_nqu4Y66HuEKlD6YRGssZuRQnPOjDm50J8Zkr"
        data-deployed-at="2023-11-22T20:39:37Z"
        data-latest-commit-id="df0b134ec4e1780faa646bdad64063e387b6a4df"
        data-ga-tracking="UA-71991109-1"
        data-ga4-tracking-id="G-TYEM8Y3JN3">
        <link rel="stylesheet" href="https://dev.to/assets/minimal-ce2284f1c9b04ffc034a5682b214006dda88306116e7a895eb23278e96ed1309.css" media="all" id="secondary-minimal-stylesheet" />
<link rel="stylesheet" href="https://dev.to/assets/views-b907f8120ea7d1917d7944d3b143e08b50dab5c29d611ef5bdcfb492922927f0.css" media="all" id="secondary-views-stylesheet" />
<link rel="stylesheet" href="https://dev.to/assets/crayons-fc1f3330b6564e7c586aaa6cddad1a5a5b5b5f962e32983114ba56cf220183a0.css" media="all" id="secondary-crayons-stylesheet" />

        <div id="body-styles">
          <style>
            :root {
              --accent-brand-lighter-rgb: 80, 99, 301;
              --accent-brand-rgb: 59, 73, 223;
              --accent-brand-darker-rgb: 47, 58, 178;
            }
          </style>
        </div>
        <div id="audiocontent" data-podcast="">
          
        </div>
        <div class="navigation-progress" id="navigation-progress"></div>
<header id="topbar" class="crayons-header topbar print-hidden">
  <span id="route-change-target" tabindex="-1"></span>
  <a href="#main-content" class="skip-content-link">Skip to content</a>
  <div class="crayons-header__container">
    <span class="inline-block m:hidden ">
      <button class="c-btn c-btn--icon-alone js-hamburger-trigger mx-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="acswnfnqk12mspzyybilu6byr9k8gq5p" class="crayons-icon"><title id="acswnfnqk12mspzyybilu6byr9k8gq5p">Navigation menu</title>
    <path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"></path>
</svg>

      </button>
    </span>
    <a href="/" class="site-logo" aria-label="DEV Community Home">
    <img class="site-logo__img" src="https://dev-to-uploads.s3.amazonaws.com/uploads/logos/resized_logo_UQww2soKuUsjaOGNB38o.png" alt="DEV Community">
</a>


    <div class="crayons-header--search js-search-form" id="header-search">
      <form accept-charset="UTF-8" method="get" action="/search" role="search">
        <div class="crayons-fields crayons-fields--horizontal">
          <div class="crayons-field flex-1 relative">
            <input class="crayons-header--search-input crayons-textfield js-search-input" type="text" id="nav-search" name="q" placeholder="Search..." autocomplete="off" />
            <button type="submit" aria-label="Search" class="c-btn c-btn--icon-alone absolute inset-px left-auto mt-0 py-0">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="ajpijtaqpazn89bpkgp6ueolioxnxarv" aria-hidden="true" class="crayons-icon"><title id="ajpijtaqpazn89bpkgp6ueolioxnxarv">Search</title>
    <path d="M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0111 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 01-1.969 5.617zm-2.006-.742A6.977 6.977 0 0018 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 004.875-1.975l.15-.15z"></path>
</svg>

            </button>
          </div>
        </div>
      </form>
    </div>

    <div class="flex items-center h-100 ml-auto">
      <a class="c-link c-link--icon-alone c-link--block m:hidden mx-1" id="search-link" aria-label="Search" href="/search">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="alhtf1qunod0yzpw326mlahbam7y9obm" class="crayons-icon"><title id="alhtf1qunod0yzpw326mlahbam7y9obm">Search</title>
    <path d="M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0111 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 01-1.969 5.617zm-2.006-.742A6.977 6.977 0 0018 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 004.875-1.975l.15-.15z"></path>
</svg>

      </a>
        <div class="flex" id="authentication-top-nav-actions">
          <span class="hidden m:block">
            <a href="/enter" class="c-link c-link--block mr-2 whitespace-nowrap ml-auto" data-no-instant>
              Log in
            </a>
          </span>

          <a href="/enter?state=new-user" data-tracking-id="ca_top_nav" data-tracking-source="top_navbar" class="c-cta c-cta--branded whitespace-nowrap mr-2" data-no-instant>
            Create account
          </a>
        </div>
    </div>
  </div>
</header>

<div class="hamburger">
  <div class="hamburger__content">
    <header class="hamburger__content__header">
      <h2 class="fs-l fw-bold flex-1 break-word lh-tight">DEV Community</h2>

      <button class="c-btn c-btn--icon-alone js-hamburger-trigger shrink-0" aria-label="Close">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="a1k7shi8q4di34h424konppoegi53cnw" aria-hidden="true" class="crayons-icon c-btn__icon"><title id="a1k7shi8q4di34h424konppoegi53cnw">Close</title><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636l4.95 4.95z"></path></svg>

      </button>
    </header>

    <div class="p-2 js-navigation-links-container" id="authentication-hamburger-actions">
    </div>
  </div>
  <div class="hamburger__overlay js-hamburger-trigger"></div>
</div>


        <div id="active-broadcast" class="broadcast-wrapper"></div>
  <div id="base-payment-pointer" data-payment-pointer="$ilp.uphold.com/24HhrUGG7ekn"></div>
<div id="page-content" class="wrapper stories stories-show" data-current-page="stories-show">
  <div id="page-content-inner">
    <div id="page-route-change" class="screen-reader-only" aria-live="polite" aria-atomic="true"></div>

    


<style>
  .html-variant-wrapper { display: none}
</style>

<script src="https://unpkg.com/@webcomponents/webcomponentsjs@2.2.10/webcomponents-loader.js"
        integrity="sha384-3HK5hxQbkFqOIxMbpROlRmRtYl2LBZ52t+tqcjzsmr9NJuOWQxl8RgQSyFvq2lhy"
        crossorigin="anonymous" defer></script>

  <script src="https://dev.to/packs/js/runtime~webShare-5cf8445b71000698bc8c.js" defer="defer"></script>
<script src="https://dev.to/packs/js/webShare-0df34c0ecde1461f7323.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/runtime~articlePage-30630a31cfb50a92121a.js" defer="defer"></script>
<script src="https://dev.to/packs/js/0-6a8935ca6bc68cd25de7.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/1-b4e73c43b525ea3bbdf5.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/articlePage-7abfac3ca82e2aaf8f34.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/runtime~commentDropdowns-3a23a84f5899af0b0d8a.js" defer="defer"></script>
<script src="https://dev.to/packs/js/commentDropdowns-b62e09c59b0261c98048.chunk.js" defer="defer"></script>

    <script type="application/ld+json">
      {"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom"},"url":"https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom","image":["https://dev.to/social_previews/article/659466.png","https://dev.to/social_previews/article/659466.png","https://dev.to/social_previews/article/659466.png"],"publisher":{"@context":"http://schema.org","@type":"Organization","name":"DEV Community","logo":{"@context":"http://schema.org","@type":"ImageObject","url":"https://res.cloudinary.com/practicaldev/image/fetch/s--b551aYX---/c_limit,f_png,fl_progressive,q_80,w_192/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8j7kvp660rqzt99zui8e.png","width":"192","height":"192"}},"headline":"Understanding Atomics and Memory Ordering","author":{"@context":"http://schema.org","@type":"Person","url":"https://dev.to/kprotty","name":"kprotty"},"datePublished":"2021-04-09T00:33:25Z","dateModified":"2021-04-09T03:06:49Z"}
    </script>

  
<div class="crayons-layout crayons-layout--3-cols crayons-layout--article">
  <aside class="crayons-layout__sidebar-left" aria-label="Article actions">
    <div class="crayons-article-actions print-hidden">
  <div class="crayons-article-actions__inner">

    
<div class="reaction-drawer__outer hoverdown" style="">
  <button
    id="reaction-drawer-trigger"
    aria-label="reaction-drawer-trigger"
    aria-pressed="false"
    class="hoverdown-trigger crayons-reaction pseudo-reaction crayons-tooltip__activator relative">
      <span class="crayons-reaction__icon crayons-reaction__icon--borderless crayons-reaction--like crayons-reaction__icon--inactive" style="width: 40px; height: 40px">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" role="img" aria-hidden="true" class="crayons-icon">
    <g clip-path="url(#clip0_988_3276)">
        <path d="M19 14V17H22V19H18.999L19 22H17L16.999 19H14V17H17V14H19ZM20.243 4.75698C22.505 7.02498 22.583 10.637 20.479 12.992L19.059 11.574C20.39 10.05 20.32 7.65998 18.827 6.16998C17.324 4.67098 14.907 4.60698 13.337 6.01698L12.002 7.21498L10.666 6.01798C9.09103 4.60598 6.67503 4.66798 5.17203 6.17198C3.68203 7.66198 3.60703 10.047 4.98003 11.623L13.412 20.069L12 21.485L3.52003 12.993C1.41603 10.637 1.49503 7.01898 3.75603 4.75698C6.02103 2.49298 9.64403 2.41698 12 4.52898C14.349 2.41998 17.979 2.48998 20.242 4.75698H20.243Z" fill="#525252"></path>
    </g>
    <defs>
        <clipPath id="clip0_988_3276">
        <rect width="24" height="24" fill="white"></rect>
        </clipPath>
    </defs>
</svg>

      </span>
      <span class="crayons-reaction__icon crayons-reaction__icon--borderless crayons-reaction__icon--active" style="width: 40px; height: 40px">
        <img aria_hidden="true" height="24" width="24" src="https://dev.to/assets/heart-plus-active-9ea3b22f2bc311281db911d416166c5f430636e76b15cd5df6b3b841d830eefa.svg" />
      </span>
      <span class="crayons-reaction__count" id="reaction_total_count">
        <span class="bg-base-40 opacity-25 p-2 inline-block radius-default"></span>
      </span>
      <span class="crayons-tooltip__content">
        Add reaction
      </span>
  </button>

  <div class="reaction-drawer" aria-expanded="false">
    <div class="reaction-drawer__container">
        <button
  id="reaction-butt-like"
  name="Like"
  aria-label="Like"
  aria-pressed="false"
  class="crayons-reaction crayons-tooltip__activator relative pt-2 pr-2 pb-1 pl-2"
  data-category="like">
    <span class="crayons-reaction__icon crayons-reaction__icon--inactive p-0">
      <img aria_hidden="true" height="32" width="32" src="https://dev.to/assets/sparkle-heart-5f9bee3767e18deb1bb725290cb151c25234768a0e9a2bd39370c382d02920cf.svg" />
    </span>
    <span class="crayons-reaction__count" id="reaction-number-like"><span class="bg-base-40 opacity-25 p-2 inline-block radius-default"></span></span>

    <span data-testid="tooltip" class="crayons-tooltip__content">
      Like
    </span>
</button>

        <button
  id="reaction-butt-unicorn"
  name="Unicorn"
  aria-label="Unicorn"
  aria-pressed="false"
  class="crayons-reaction crayons-tooltip__activator relative pt-2 pr-2 pb-1 pl-2"
  data-category="unicorn">
    <span class="crayons-reaction__icon crayons-reaction__icon--inactive p-0">
      <img aria_hidden="true" height="32" width="32" src="https://dev.to/assets/multi-unicorn-b44d6f8c23cdd00964192bedc38af3e82463978aa611b4365bd33a0f1f4f3e97.svg" />
    </span>
    <span class="crayons-reaction__count" id="reaction-number-unicorn"><span class="bg-base-40 opacity-25 p-2 inline-block radius-default"></span></span>

    <span data-testid="tooltip" class="crayons-tooltip__content">
      Unicorn
    </span>
</button>

        <button
  id="reaction-butt-exploding_head"
  name="Exploding Head"
  aria-label="Exploding Head"
  aria-pressed="false"
  class="crayons-reaction crayons-tooltip__activator relative pt-2 pr-2 pb-1 pl-2"
  data-category="exploding_head">
    <span class="crayons-reaction__icon crayons-reaction__icon--inactive p-0">
      <img aria_hidden="true" height="32" width="32" src="https://dev.to/assets/exploding-head-daceb38d627e6ae9b730f36a1e390fca556a4289d5a41abb2c35068ad3e2c4b5.svg" />
    </span>
    <span class="crayons-reaction__count" id="reaction-number-exploding_head"><span class="bg-base-40 opacity-25 p-2 inline-block radius-default"></span></span>

    <span data-testid="tooltip" class="crayons-tooltip__content">
      Exploding Head
    </span>
</button>

        <button
  id="reaction-butt-raised_hands"
  name="Raised Hands"
  aria-label="Raised Hands"
  aria-pressed="false"
  class="crayons-reaction crayons-tooltip__activator relative pt-2 pr-2 pb-1 pl-2"
  data-category="raised_hands">
    <span class="crayons-reaction__icon crayons-reaction__icon--inactive p-0">
      <img aria_hidden="true" height="32" width="32" src="https://dev.to/assets/raised-hands-74b2099fd66a39f2d7eed9305ee0f4553df0eb7b4f11b01b6b1b499973048fe5.svg" />
    </span>
    <span class="crayons-reaction__count" id="reaction-number-raised_hands"><span class="bg-base-40 opacity-25 p-2 inline-block radius-default"></span></span>

    <span data-testid="tooltip" class="crayons-tooltip__content">
      Raised Hands
    </span>
</button>

        <button
  id="reaction-butt-fire"
  name="Fire"
  aria-label="Fire"
  aria-pressed="false"
  class="crayons-reaction crayons-tooltip__activator relative pt-2 pr-2 pb-1 pl-2"
  data-category="fire">
    <span class="crayons-reaction__icon crayons-reaction__icon--inactive p-0">
      <img aria_hidden="true" height="32" width="32" src="https://dev.to/assets/fire-f60e7a582391810302117f987b22a8ef04a2fe0df7e3258a5f49332df1cec71e.svg" />
    </span>
    <span class="crayons-reaction__count" id="reaction-number-fire"><span class="bg-base-40 opacity-25 p-2 inline-block radius-default"></span></span>

    <span data-testid="tooltip" class="crayons-tooltip__content">
      Fire
    </span>
</button>

    </div>
  </div>
</div>

<button
  id="reaction-butt-comment"
  aria-label="Jump to Comments"
  aria-pressed="false"
  class="crayons-reaction crayons-reaction--comment crayons-tooltip__activator relative"
  data-category="comment">
    <span class="crayons-reaction__icon crayons-reaction__icon--borderless crayons-reaction__icon--inactive">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-hidden="true" class="crayons-icon">
    <path d="M10 3h4a8 8 0 010 16v3.5c-5-2-12-5-12-11.5a8 8 0 018-8zm2 14h2a6 6 0 000-12h-4a6 6 0 00-6 6c0 3.61 2.462 5.966 8 8.48V17z"></path>
</svg>

    </span>
    <span class="crayons-reaction__count" id="reaction-number-comment" data-count="4">
      <span class="bg-base-40 opacity-25 p-2 inline-block radius-default"></span>
    </span>

    <span data-testid="tooltip" class="crayons-tooltip__content">
      Jump to Comments
    </span>
</button>

<button
  id="reaction-butt-readinglist"
  aria-label="Add to reading list"
  aria-pressed="false"
  class="crayons-reaction crayons-reaction--readinglist crayons-tooltip__activator relative"
  data-category="readinglist">
    <span class="crayons-reaction__icon crayons-reaction__icon--borderless crayons-reaction__icon--inactive">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-hidden="true" class="crayons-icon">
    <path d="M5 2h14a1 1 0 011 1v19.143a.5.5 0 01-.766.424L12 18.03l-7.234 4.536A.5.5 0 014 22.143V3a1 1 0 011-1zm13 2H6v15.432l6-3.761 6 3.761V4z"></path>
</svg>

    </span>
    <span class="crayons-reaction__count" id="reaction-number-readinglist"><span class="bg-base-40 opacity-25 p-2 inline-block radius-default"></span></span>

    <span data-testid="tooltip" class="crayons-tooltip__content">
      Save
    </span>
</button>



    <div id="mod-actions-menu-btn-area" class="print-hidden trusted-visible-block align-center">
    </div>
    <div class="align-center m:relative">
      <button id="article-show-more-button" aria-controls="article-show-more-dropdown" aria-expanded="false" aria-haspopup="true" class="dropbtn crayons-btn crayons-btn--ghost-dimmed crayons-btn--icon-rounded" aria-label="Share post options">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" role="img" aria-labelledby="an7r1ax3v0b5jrwkolmpz79u4172uc7a" aria-hidden="true" class="crayons-icon dropdown-icon"><title id="an7r1ax3v0b5jrwkolmpz79u4172uc7a">More...</title><path fill-rule="evenodd" clip-rule="evenodd" d="M7 12a2 2 0 11-4 0 2 2 0 014 0zm7 0a2 2 0 11-4 0 2 2 0 014 0zm5 2a2 2 0 100-4 2 2 0 000 4z"></path></svg>

      </button>

      <div id="article-show-more-dropdown" class="crayons-dropdown side-bar left-2 right-2 m:right-auto m:left-100 s:left-auto mb-1 m:mb-0 top-unset bottom-100 m:top-0 m:bottom-unset">
        <div>
          <button
            id="copy-post-url-button"
            class="flex justify-between crayons-link crayons-link--block w-100 bg-transparent border-0"
            data-postUrl="https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom">
            <span class="fw-bold">Copy link</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" id="article-copy-icon" role="img" aria-labelledby="ad3o3ouh7qaff0kuhos68o94bnjtf2la" aria-hidden="true" class="crayons-icon mx-2 shrink-0"><title id="ad3o3ouh7qaff0kuhos68o94bnjtf2la">Copy link</title>
    <path d="M7 6V3a1 1 0 011-1h12a1 1 0 011 1v14a1 1 0 01-1 1h-3v3c0 .552-.45 1-1.007 1H4.007A1 1 0 013 21l.003-14c0-.552.45-1 1.007-1H7zm2 0h8v10h2V4H9v2zm-2 5v2h6v-2H7zm0 4v2h6v-2H7z"></path>
</svg>

          </button>
          <div id="article-copy-link-announcer" aria-live="polite" class="crayons-notice crayons-notice--success my-2 p-1" aria-live="polite" hidden>Copied to Clipboard</div>
        </div>

        <div class="Desktop-only">
          <a
            target="_blank"
            class="crayons-link crayons-link--block"
            rel="noopener"
            href='https://twitter.com/intent/tweet?text=%22Understanding%20Atomics%20and%20Memory%20Ordering%22%20by%20kprotty%20%23DEVCommunity%20https%3A%2F%2Fdev.to%2Fkprotty%2Funderstanding-atomics-and-memory-ordering-2mom'>
            Share to Twitter
          </a>
          <a
            target="_blank"
            class="crayons-link crayons-link--block"
            rel="noopener"
            href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fdev.to%2Fkprotty%2Funderstanding-atomics-and-memory-ordering-2mom&title=Understanding%20Atomics%20and%20Memory%20Ordering&summary=Atomics%20and%20Memory%20Ordering%20always%20feel%20like%20an%20unapproachable%20topic.%20In%20the%20sea%20of%20poor%20explanations...&source=DEV%20Community">
            Share to LinkedIn
          </a>
          <a
            target="_blank"
            class="crayons-link crayons-link--block"
            rel="noopener"
            href="https://www.reddit.com/submit?url=https%3A%2F%2Fdev.to%2Fkprotty%2Funderstanding-atomics-and-memory-ordering-2mom&title=Understanding%20Atomics%20and%20Memory%20Ordering">
            Share to Reddit
          </a>
          <a
            target="_blank"
            class="crayons-link crayons-link--block"
            rel="noopener"
            href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fdev.to%2Fkprotty%2Funderstanding-atomics-and-memory-ordering-2mom&t=Understanding%20Atomics%20and%20Memory%20Ordering">
            Share to Hacker News
          </a>
          <a
            target="_blank"
            class="crayons-link crayons-link--block"
            rel="noopener"
            href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fdev.to%2Fkprotty%2Funderstanding-atomics-and-memory-ordering-2mom">
            Share to Facebook
          </a>
          <a
            target="_blank"
            class="crayons-link crayons-link--block"
            rel="noopener"
            href="https://toot.kytta.dev/?text=https%3A%2F%2Fdev.to%2Fkprotty%2Funderstanding-atomics-and-memory-ordering-2mom">
            Share to Mastodon
          </a>
        </div>

        <web-share-wrapper shareurl="https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom" sharetitle="Understanding Atomics and Memory Ordering" sharetext="Atomics and Memory Ordering always feel like an unapproachable topic. In the sea of poor explanations..." template="web-share-button">
        </web-share-wrapper>
        <template id="web-share-button">
          <a href="#" class="dropdown-link-row crayons-link crayons-link--block">Share Post via...</a>
        </template>

        <a href="/report-abuse" class="crayons-link crayons-link--block">Report Abuse</a>
      </div>
    </div>
  </div>
</div>

  </aside>

  <main id="main-content" class="crayons-layout__content grid gap-4">
    <div class="article-wrapper">


      <article class="crayons-card crayons-article mb-4"
        id="article-show-container"
        data-article-id="659466"
        data-article-slug="understanding-atomics-and-memory-ordering-2mom"
        data-author-id="610982"
        data-author-name="kprotty"
        data-author-username="kprotty"
        data-co-author-ids=""
        data-path="/kprotty/understanding-atomics-and-memory-ordering-2mom"
        data-pin-path="/stories/feed/pinned_article"
        data-pinned-article-id=""
        data-published="true"
        data-scheduled="false"
        lang=en
         >
        <header class="crayons-article__header" id="main-title">

          <div class="crayons-article__header__meta">
            <div class="flex s:items-start flex-col s:flex-row">
              <div id="action-space" class="crayons-article__actions mb-4 s:mb-0 s:order-last"></div>
              <div class="flex flex-1 mb-5 items-start">
                <div class="relative">
                    <a href="/kprotty"><img class="radius-full align-middle" src="https://res.cloudinary.com/practicaldev/image/fetch/s--I28RC1Py--/c_fill,f_auto,fl_progressive,h_50,q_auto,w_50/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/610982/4489bc94-50d9-4aa7-9364-e38f3d3d9258.jpeg" width="40" height="40" alt="kprotty" /></a>
                </div>
                <div class="pl-3 flex-1">
                  <a href="/kprotty" class="crayons-link fw-bold">kprotty</a>
                  <p class="fs-xs color-base-60">
                      Posted on <time datetime="2021-04-09T00:33:25Z" class="date">Apr 9, 2021</time>


                  </p>
                </div>
              </div>
            </div>

            <div class="multiple_reactions_engagement">
    <span class="reaction_engagement_like hidden">
      <img src="https://dev.to/assets/sparkle-heart-5f9bee3767e18deb1bb725290cb151c25234768a0e9a2bd39370c382d02920cf.svg" width="24" height="24" />
      <span id="reaction_engagement_like_count">&nbsp;</span>
    </span>
    <span class="reaction_engagement_unicorn hidden">
      <img src="https://dev.to/assets/multi-unicorn-b44d6f8c23cdd00964192bedc38af3e82463978aa611b4365bd33a0f1f4f3e97.svg" width="24" height="24" />
      <span id="reaction_engagement_unicorn_count">&nbsp;</span>
    </span>
    <span class="reaction_engagement_exploding_head hidden">
      <img src="https://dev.to/assets/exploding-head-daceb38d627e6ae9b730f36a1e390fca556a4289d5a41abb2c35068ad3e2c4b5.svg" width="24" height="24" />
      <span id="reaction_engagement_exploding_head_count">&nbsp;</span>
    </span>
    <span class="reaction_engagement_raised_hands hidden">
      <img src="https://dev.to/assets/raised-hands-74b2099fd66a39f2d7eed9305ee0f4553df0eb7b4f11b01b6b1b499973048fe5.svg" width="24" height="24" />
      <span id="reaction_engagement_raised_hands_count">&nbsp;</span>
    </span>
    <span class="reaction_engagement_fire hidden">
      <img src="https://dev.to/assets/fire-f60e7a582391810302117f987b22a8ef04a2fe0df7e3258a5f49332df1cec71e.svg" width="24" height="24" />
      <span id="reaction_engagement_fire_count">&nbsp;</span>
    </span>
</div>


            <h1 class="fs-3xl m:fs-4xl l:fs-5xl fw-bold s:fw-heavy lh-tight mb-2 medium">
              Understanding Atomics and Memory Ordering
            </h1>

              <div class="spec__tags flex flex-wrap">
                  <a class="crayons-tag   " style="
        --tag-bg: rgba(1, 71, 132, 0.10);
        --tag-prefix: #014784;
        --tag-bg-hover: rgba(1, 71, 132, 0.10);
        --tag-prefix-hover: #014784;
      " href="/t/cpp"><span class="crayons-tag__prefix">#</span>cpp</a>
                  <a class="crayons-tag   " style="
        --tag-bg: rgba(59, 73, 223, 0.10);
        --tag-prefix: #3b49df;
        --tag-bg-hover: rgba(59, 73, 223, 0.10);
        --tag-prefix-hover: #3b49df;
      " href="/t/atomic"><span class="crayons-tag__prefix">#</span>atomic</a>
                  <a class="crayons-tag   " style="
        --tag-bg: rgba(59, 73, 223, 0.10);
        --tag-prefix: #3b49df;
        --tag-bg-hover: rgba(59, 73, 223, 0.10);
        --tag-prefix-hover: #3b49df;
      " href="/t/llvm"><span class="crayons-tag__prefix">#</span>llvm</a>
                  <a class="crayons-tag   " style="
        --tag-bg: rgba(59, 73, 223, 0.10);
        --tag-prefix: #3b49df;
        --tag-bg-hover: rgba(59, 73, 223, 0.10);
        --tag-prefix-hover: #3b49df;
      " href="/t/optimization"><span class="crayons-tag__prefix">#</span>optimization</a>
              </div>
          </div>
        </header>

        <div class="crayons-article__main">

          <div class="crayons-article__body text-styles spec__body" data-article-id="659466" id="article-body">
            <p>Atomics and Memory Ordering always feel like an unapproachable topic. In the sea of poor explanations, I wish to add another by describing how I reason about all of this mess. This is only my understanding so if you need a better/formal explanation, I recommend reading through the memory model for your given programming language. In this case, it would be the C11 Memory Model described at <a href="https://en.cppreference.com/w/cpp/atomic/memory_order">cppreference.com</a>. </p>

<h1>
  <a name="shared-memory" href="#shared-memory">
  </a>
  Shared Memory
</h1>

<p>Software and hardware is getting closer to the limits of performance when it comes to single-threaded execution of code. In order to continue scaling compute performance, a popular solution is to introduce multiple single-threaded execution units - or multi-threading. This form of computation manifests itself at different abstraction levels from multiple cores in a CPU to multiple CPUs in a machine and even multiple machines across a network. This post will be focusing more on cores in a CPU, referring to them as “threads”.</p>

<p>For some workloads, the tasks can be divided cleanly and split off to the threads for execution. Such tasks are known as <a href="https://en.wikipedia.org/wiki/Embarrassingly_parallel">embarrassingly parallel</a> and need not communicate with each other. This is the ideal that multithreaded algorithms should strive for since it takes advantage of all the existing optimizations available for single-threaded execution. However this isn't always possible and it's sometimes necessary for tasks to communicate and coordinate with each other, which is why we need to share memory between threads.</p>

<p>Communication is hard when your code is running in a preemptive scheduling setting. Such an environment means that, at any point, your code can be interrupted in order for other code to run. In applications, the operating system kernel can decide to switch from running your program to run another. In the kernel, hardware can switch from running kernel code to running interrupt handler code. Switching tasks around like this is known as concurrency and in order to synchronize/communicate, we need a way to exclude that concurrency for a small time frame or we risk operating with incomplete/partial data.</p>

<h1>
  <a name="atomics" href="#atomics">
  </a>
  Atomics
</h1>

<p>Fortunately, CPUs supply software with special instructions to operate on shared memory which can't be interrupted. These are known as atomic memory operations and fit into three categories: Loads, Stores, and ReadModifyWrites (RMW). The first two are self explanatory. RMW is also pretty descriptive: it allows you to load data from memory, operate on the data, and store the result back into memory - all atomically. You may know RMW operations as atomic <a href="https://docs.microsoft.com/en-us/windows/win32/api/winnt/nf-winnt-interlockedincrement">increment</a>, <a href="https://en.cppreference.com/w/cpp/atomic/atomic/exchange">swap</a>, or <a href="https://en.wikipedia.org/wiki/Compare-and-swap">compare and swap</a>.</p>

<p>To do something "atomically" means that it must happen (or be observed to happen) in its entirety or not at all. This implies that it cannot be interrupted. When something is "atomic", tearing (i.e. partial completion) of the operation cannot be observed. Atomic operations allow us to write code that can work with shared memory in a way that's safe against concurrent interruption.</p>

<p>Another thing about atomics is that they're the only sound (i.e. correctly defined) way to interact with shared memory when there's at least one writer and possibly multiple readers/writers to the shared memory. Trying to do so without atomics is considered a <a href="https://en.wikipedia.org/wiki/Race_condition#Data_race">data race</a> which is <a href="https://en.cppreference.com/w/cpp/language/ub">undefined behavior</a> (UB). UB is the act of relying on an assumption outside of your target program model (in our case, the C11 memory model). Doing so is unreliable as the compiler or cpu is allowed to do anything outside of its model.</p>

<p>Data races and the UB it implies isn’t just a theoretical issue. One of the single-threaded optimizations I mentioned earlier involves either the CPU or the compiler caching memory reads and writes. If you don’t use atomic operations, the operation itself could be ellided and replaced with its cached result which could break the logic of your code fairly easily:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="c1"># should be an atomic_load() but its data race
</span><span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">load</span><span class="p">(</span><span class="nb">bool</span><span class="p">)):</span>
    <span class="k">continue</span>

<span class="c1"># a potential single-threaded optimization
</span><span class="n">cached</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">cached</span><span class="p">):</span> <span class="c1"># possibly infinite loop!
</span>    <span class="k">continue</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h1>
  <a name="reordering" href="#reordering">
  </a>
  Reordering
</h1>

<p>Atomics solve communication only on atomically accessed memory; but not all memory being communicated can be accessed atomically. CPUs generally expose atomic operations for memory that's at most a few bytes large. Trying to do any other sort of general purpose memory communication means we need a way to make this memory available to threads with other means.</p>

<p>Making memory available to other threads is actually trickier than it sounds. Let's check out this code example:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">has_data</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># Thread 1
</span><span class="n">write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">)</span>
<span class="n">atomic_store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">has_data</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

<span class="c1"># Thread 2
</span><span class="k">if</span> <span class="n">atomic_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">has_data</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">)</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="s">"hello"</span><span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>At first glance, this looks like it would work. Even if each thread were preempted between each instruction (line of code here), it seems the assert() should always succeed. Based on my wording, you've probably caught on that this assert() can actually fail! The reason for this is due to another single-threaded optimization called reordering.</p>

<p>Hardware (CPU) or software (the compiler as well) can decide to move around (i.e. “reorder”) your code and instructions any way they please as long as the end result is the same as the source code’s intent. This sort of “instruction scheduling” freedom allows for a variety of optimizations to take place.</p>

<p>One example of reordering is via speculative execution. This is when the CPU starts executing code that hasn't been reached yet, in the opportunistic chance that the results can be ready when that code is eventually reached. This is an amazing single-threaded throughput optimization, but it means that the <code>atomic_store()</code> can be started before the <code>write()</code>, or the <code>read()</code> can be started before the <code>atomic_load()</code>; both of which could make the assert() fail.</p>

<p>Another example of reordering is by CPU caches. CPUs don't read/write directly to shared memory since that's <a href="https://gist.github.com/jboner/2841832">relatively slow</a>. Instead, each CPU core has its own fast-access, local memory called cache. Most memory operations are performed on a CPU's cache and eventually flushed to / refreshed from to other caches in a process called <a href="https://en.wikipedia.org/wiki/Cache_coherence">Cache Coherency</a>. In our example, the <code>atomic_store()</code> could have flushed from cache to shared memory before the <code>write()</code> does (e.g. if flushing is done LIFO), or the <code>atomic_load()</code> could refresh in cache before the <code>read()</code> is; both of which could cause the assert() to fail.</p>

<p>Even the compiler can reorder instructions, but only those without relationships called <em>dependencies</em>. One instruction (line of code) is said to "depend" on a previous instruction if it uses the result from the previous one or if the previous one is a <a href="https://en.wikipedia.org/wiki/Side_effect_(computer_science)">side effect</a>. The compiler is free to reorder instructions anywhere before their dependency, but not after. This means <code>a = 5; b = 10;</code> can be reordered to <code>b = 10; a = 5;</code> which keeps the same semantics (achieving the same thing) since "a" and "b" don't share a dependency with each other. If it were instead <code>a = 5; b = a + 1;</code> then "a" can't be moved after "b" since it wouldn't make logical sense as "b" has a dependency on "a". In our example, <code>atomic_store()</code> doesn't have a dependency on <code>write()</code> so it can be moved around which can make the assert() fail.</p>

<p>At this point it should be clear that instruction reordering is a thing and, when interacting with shared memory, you have to be aware of it. The problem is that <strong>atomic operations on their own don't prevent reordering</strong>. We need an additional concept for atomics to do this. In C11, atomic operations take in another parameter called "memory ordering" which helps solve this problem.</p>

<p>In our previous code example, there were two main issues: one of reordering and one of visibility. Memory orderings solve them by preventing code from being reordered around atomic operations and ensures that certain data or operations become visible or get conceptually "flushed/reloaded from cache". Lets see what this looks like.</p>

<h1>
  <a name="release-and-acquire" href="#release-and-acquire">
  </a>
  Release and Acquire
</h1>

<p>We'll introduce two types of memory orderings for now: <a href="https://en.cppreference.com/w/cpp/atomic/memory_order#Release-Acquire_ordering">Acquire and Release</a>. Release goes on atomic stores and ensures that all memory operations declared before it actually happen before it. Acquire goes on atomic loads and ensures all memory operations declared after actually happen after it. This solves the reordering problem.</p>

<p>We then declare one more constraint: All memory operations before a given Release can be observed to <a href="https://en.wikipedia.org/wiki/Happened-before">happen-before</a> a matching Acquire. You could think of it as changes from the Release becoming visible in a <code>git push</code> manner to the Acquire which does a sort of <code>git pull</code>. This solves the visibility problem.</p>

<p>Let's add these to our code example:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">has_data</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># Thread 1
</span><span class="n">write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">)</span>
<span class="n">atomic_store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">has_data</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">Release</span><span class="p">)</span>

<span class="c1"># Thread 2
</span><span class="k">if</span> <span class="n">atomic_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">has_data</span><span class="p">,</span> <span class="n">Acquire</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">)</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="s">"hello"</span><span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Note that <strong>Release and Acquire don't do any sort of "waiting" or "blocking" for the data to become ready</strong>. They aren't replacements for known synchronization primitives. Instead, they ensure that <em>if</em> our atomic_load() sees <code>has_data</code> to be True, <em>then</em> it’s also guaranteed to see <code>write(&amp;data, "hello")</code> thanks to the matching Acquire and Release barriers so our assert should never fail.</p>

<p>For ReadModifyWrite (RMW) atomic instructions, they can also take in a memory ordering called <code>AcqRel</code>. Given RMW operations conceptually do both an atomic load and an atomic store, <code>AcqRel</code> makes both operations Acquire and Release respectively. This is useful when you want an atomic operation which both 1) makes memory available to other threads via Release and 2) sees memory made available by other threads via Acquire.</p>

<h2>
  <a name="fences-and-variables" href="#fences-and-variables">
  </a>
  Fences and Variables
</h2>

<p>You'll notice that i've been saying <em>"matching Acquire/Release"</em>. For our examples, the matching is from the load and store using the same "atomic variable' (<code>&amp;has_data</code>). Release and Acquires on different atomic variables don't synchronize with each other, it has to be the same atomic variable.</p>

<p>There's an exception to the rule which manifests itself as fences. Fences are a way to establish memory orderings of normal and atomic memory operations without necessarily associating with one given memory op.</p>

<p>Fences are a bit tricky for me as I have a hard time describing them, but they essentially create the happens-before relationship to surround atomics in a way that corresponds to the memory ordering being used:</p>

<ul>
<li>A <code>fence(Release)</code> creates a happens-before relationship with another <code>fence(Acquire)</code>
</li>
<li>A <code>fence(Release)</code> makes subsequent non-Release atomic stores into Release if they have a matching Acquire atomic load or matching <code>fence(Acquire)</code>
</li>
<li>A <code>fence(Acquire)</code> makes previous non-Acquire atomic loads into Acquire if they have a matching Release atomic store or matching <code>fence(Release)</code>.</li>
</ul>

<p>Here's an example of how we could substitute the per-operation memory orderings with fences:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">has_data</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># Thread 1
</span><span class="n">write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">)</span>
<span class="n">fence</span><span class="p">(</span><span class="n">Release</span><span class="p">)</span>
<span class="n">atomic_store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">has_data</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

<span class="c1"># Thread 2
</span><span class="k">if</span> <span class="n">atomic_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">has_data</span><span class="p">):</span>
    <span class="n">fence</span><span class="p">(</span><span class="n">Acquire</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">)</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="s">"hello"</span><span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<h2>
  <a name="case-study-mutex" href="#case-study-mutex">
  </a>
  Case Study: Mutex
</h2>

<p>You may have also noticed that this section is called "Release and Acquire" instead of "Acquire and Release". This is done intentionally as having Acquire first often construes the happens-before relationship. Instead of thinking about lock(Acquire) and unlock(Release), it should instead be thought about unlock(Release) making critical section changes available to lock(Acquire):<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="n">mutex</span> <span class="o">=</span> <span class="n">Mutex</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c1"># Thread 1 (assume locked)
</span>    <span class="n">data</span> <span class="o">=</span> <span class="s">"hello"</span>
    <span class="n">fence</span><span class="p">(</span><span class="n">Release</span><span class="p">)</span>
    <span class="n">mutex</span><span class="p">.</span><span class="n">unlock</span><span class="p">()</span>

<span class="c1"># Thread 2 (assume unlocked)
</span>    <span class="n">mutex</span><span class="p">.</span><span class="n">lock</span><span class="p">()</span>
    <span class="n">fence</span><span class="p">(</span><span class="n">Acquire</span><span class="p">)</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="s">"hello"</span><span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>The Release ordering for a mutex only serves to "Release" the changes to the next mutex locker, who "Acquires" the previously released changes by the last mutex unlocker. The canonically backwards relationship better demonstrates the happens-before relationship between Release and Acquire compared to just saying <em>"lock() acquires and unlock() releases"</em>.</p>

<p>What we have created here is called a Partial Ordering. It's an ordering between two sets of (memory) operations. The reason it's "partial" is because it orders between sets instead of the individual operations themselves: The operations before a Release don't need to be observed happening in the order they were described for an Acquire, they just need to be observed to have happened <em>at all</em>.</p>

<h1>
  <a name="sequential-consistency" href="#sequential-consistency">
  </a>
  Sequential Consistency
</h1>

<p>There are cases when you need certain atomic operations to be observed in a given order between each other. What we need now is a Total Ordering. This ensures there's some defined ordering between the operations themselves rather than a set of operations and is what the <code>SeqCst</code> memory ordering is used for.</p>

<p>Let's see another code example:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="n">head</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">tail</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">buf</span> <span class="o">=</span> <span class="p">[...]</span>

<span class="c1"># Thread 1
</span><span class="n">steal</span><span class="p">():</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">atomic_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">head</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">atomic_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tail</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">h</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">atomic_cas</span><span class="p">(</span><span class="o">&amp;</span><span class="n">head</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">item</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="c1"># Thread 2
</span><span class="n">pop</span><span class="p">():</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">tail</span>
    <span class="n">atomic_store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tail</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">atomic_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">head</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">buf</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">atomic_cas</span><span class="p">(</span><span class="o">&amp;</span><span class="n">head</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">buf</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">atomic_store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tail</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">None</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This is code taken from the implementation of a <a href="https://fzn.fr/readings/ppopp13.pdf">LIFO Deque by Chase. Lev</a>. What it does isn't necessarily important but it serves as a nice example when <code>SeqCst</code> is actually needed. </p>

<p>For pop(), we want to ensure that the store to <code>tail</code> is observed to happen before the load to <code>head</code>. If not, pop() may not see the items removed from steal(). Lets try to apply Acquire and Release to pop():<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="n">atomic_store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tail</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Release</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">atomic_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">head</span><span class="p">,</span> <span class="n">Acquire</span><span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>This doesn't exactly do what we want: Release prevents stuff <em>before</em> the store() being reordered after, and Acquire prevents stuff <em>after</em> the load() being reordered before it. There's no guarantee that the store() and load() <em>themselves</em> can't be reordered before/after each other.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>        other memory operations
    ^       |            
    |       X     store release----
    |                             |
    ----load acquire    X         |
                        |         v
        other memory operations
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>In order to ensure that the atomic store() and load() stay in their declared order we either need an Acquire barrier on the store(), which we can semantically achieve using an RMW operation with AcqRel (<code>atomic_swap(&amp;tail, t - 1, AcqRel)</code>), or we need <code>SeqCst</code>.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="n">atomic_store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tail</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SeqCst</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">atomic_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">head</span><span class="p">,</span> <span class="n">SeqCst</span><span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>SeqCst does two things here: It acts as a Release for stores / Acquire for loads as before, but it also ensures a total-ordering between all SeqCst operations. The total-ordering ensures that the store will be seen before the load for other totally-ordered operations. Because total-ordering only applies to other SeqCst ops, we need to apply SeqCst to everything that relies on the total-ordering. This includes the atomic load/cas in pop() as well as the atomic loads/cas in steal(). The total-ordering property also extends to <code>fence(SeqCst)</code> so we can use those to achieve the same reordering effects:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight python"><code><span class="n">steal</span><span class="p">():</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">atomic_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tail</span><span class="p">)</span>
  <span class="n">fence</span><span class="p">(</span><span class="n">SeqCst</span><span class="p">)</span>
  <span class="n">h</span> <span class="o">=</span> <span class="n">atomic_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">head</span><span class="p">)</span>
  <span class="p">...</span>

<span class="n">pop</span><span class="p">():</span>
  <span class="n">atomic_store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tail</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">fence</span><span class="p">(</span><span class="n">SeqCst</span><span class="p">)</span>
  <span class="n">h</span> <span class="o">=</span> <span class="n">atomic_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">head</span><span class="p">)</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>To be clear, <code>SeqCst</code> shouldn't be used to somehow gain Acquire on stores or Release on loads. That can lead to incorrect usage: <code>store(SeqCst); load(Acquire)</code> doesn't ensure that the store will not be reordered after the load() since the load() isn't a part of its total-ordering (it's not SeqCst as well).</p>

<p>It should be used instead to enforce a total-ordering between multiple atomic variables and introduce partial ordering (Acquire/Release as before) which together can achieve the same effect. More emphasis that <strong>total ordering only applies to other SeqCst atomic operations</strong> or to surrounding ops in relation to <code>fence(SeqCst)</code>. See <a href="https://github.com/rust-lang/nomicon/issues/166">this issue</a> for more warnings.</p>

<h1>
  <a name="weak-orderings" href="#weak-orderings">
  </a>
  Weak orderings
</h1>

<p>In most cases you probably don't need total-ordering on operations for multiple atomic variables. Having the requirement for <code>SeqCst</code> is pretty rare. In practice, <code>SeqCst</code> is unfortunately often overused and a problematic sign that the programmer wasn't sure what memory ordering to use... Anyway, when you don't want total-ordering over different atomic variables and don't need partial ordering, you should reach for the <a href="https://en.cppreference.com/w/cpp/atomic/memory_order#Relaxed_ordering">Relaxed</a> memory ordering (also known as Monotonic under LLVM).</p>

<p>All this does is ensure a total-order between all atomic operations <strong>to the same atomic variable</strong>. In other words, other memory operations not on the same memory location can be reordered around it. So <code>store(X); load(Y)</code> can be reordered around each other but <code>store(Y); load(Y)</code> can't.</p>

<p>All other memory orderings (Acquire/Release/AcqRel/SeqCst) inherit the Relaxed property of "single variable total-ordering" and are known to be "stronger" than it. Relaxed is useful for things like counters or generic single-atomic data that you just read, update, and check out. You cannot use this to synchronize other normal <em>or</em> atomic memory operations.</p>

<p>There are even cases where you don't need the total-ordering on the same atomic variable itself and just want to perform some memory operation atomically (i.e. to be free of data-races). For this, you would use the LLVM's <a href="https://llvm.org/docs/Atomics.html#unordered">Unordered</a> memory ordering. The need for this ordering is even more rare than the need for <code>SeqCst</code>. Unordered also isn't even present in the C11 memory model (it only gets as "weak" as Relaxed).</p>

<h1>
  <a name="hardware-quirks" href="#hardware-quirks">
  </a>
  Hardware Quirks
</h1>

<p>On modern CPU instruction set architectures (ISA), normal memory operations are atomic by default. The upside is that you don't pay a price for Relaxed/Unordered memory orderings or atomic loads/stores vs normal operations. The downside is that data-races don't exist for the ISA so it's harder to know if you have one or not. Fortunately there are tools which can instrument your memory accesses to detect data races like LLVM's <a href="https://clang.llvm.org/docs/ThreadSanitizer.html">ThreadSanitizer</a> (TSAN).</p>

<p>Certain CPU ISAs are known to have Total-Store-Ordering (TSO). This includes things like x86 and SPARC. Here, upon normal memory operations being atomic, they also get partial ordering for free. This means loads are Acquire by default and stores are Release by default. As before, you get the benefit of Release/Acquire operations having no overhead (besides inhibiting compiler optimizations) but it also has its downsides. In this case, it lets you be pretty free with orderings so your Relaxed code that should be Release/Acquire will work there but break on other architectures making it easy to write code with incorrect memory orderings.</p>

<p>The "other" architectures mentioned are called Weakly-Ordered ISAs. This includes things like ARM, AARCH64, POWERPC, RISCV, MIPS, etc. Here, loads and stores are still atomic by default but they're only Relaxed and you pay prices for Acquire/Release. This means that getting ordering wrong gives you a higher chance of observing incorrect behavior. The weaker default orderings theoretically allow for more reordering opportunities by the CPU but this doesn't appear to matter in practice given how much better modern x86 CPUs are for cross-core communication in the general case.</p>

<p>When it comes to Sequential Consistency however, there aren't really any platforms where you get this for free. <code>fence(SeqCst)</code> in particular is generally the most costly since it often requires a full barrier to implement which prevents all forms of reordering. On x86, it's achieved with <code>mfence</code> although <a href="https://stackoverflow.com/a/50279772">it can be done cheaper</a> using <code>lock</code> prefixed instructions if you're not synchronizing write-combined memory instructions. SeqCst loads/stores often require either promotion to RMW ops or Acquire/Release barriers to keep their semantics. This may be why SeqCst operations are rumored to be "slow" (they really aren't).</p>

<h1>
  <a name="conclusion" href="#conclusion">
  </a>
  Conclusion
</h1>

<p>Working with atomic operations requires reasoning about memory very differently than you would normally. You have to take into account both concurrency for the validity of your atomic algorithm, and reordering/visibility for the validity of your algorithm's memory access. It's no wonder that it's considered a challenging topic to tackle.</p>

<p>Hopefully you have Acquired some of this Released information in a way which gives you more visibility into how all of this stuff works. There's more to discuss with atomics than presented here such as how to build correct atomic data structures, handling concurrent memory reclamation, and reducing synchronization. These are all interesting in their own right, but should be saved for another time.</p>


          </div>

        </div>
          <section id="comments" data-follow-button-container="true" data-updated-at="2023-11-24 09:16:46 UTC" class="text-padding mb-4 border-t-1 border-0 border-solid border-base-10">
      <header class="relative flex justify-between items-center mb-6">
        <div class="flex items-center">
          <h2 class="crayons-subtitle-1">
            Top comments <span class="js-comments-count" data-comments-count="4">(4)</span>
          </h2>
          <button class="c-btn c-btn--ghost crayons-btn--icon-left" id="toggle-comments-sort-dropdown" aria-controls="comments-sort-dropdown-container" aria-expanded="false" aria-label="Sort comments" aria-haspopup="true">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true" class="mt-2"><title>Crown</title>
    <path d="M12 18l-4-3.771 1-.943 3 2.829 3-2.829 1 .943L12 18zm0-10.115l-3 2.829-1-.943L12 6l4 3.771-1 .942-3-2.828z"></path>
</svg>

          </button>
        </div>

        <nav class="crayons-dropdown p-4" id="comments-sort-dropdown-container" aria-labelledby="comments-sort-title">
            <h3 id="comments-sort-title" class="mb-3">Sort discussion: </h3>
            <ul class="comments-sort-dropdown__list">
              <li class="comment-sort-option">
  <a
    href="/kprotty/understanding-atomics-and-memory-ordering-2mom?comments_sort=top#toggle-comments-sort-dropdown"
    class="comment-sort-option__header pl-7 pb-0 crayons-link--block block"
    aria-describedby="top-description-text"
    aria-current="page">
    <div>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" role="img" aria-labelledby="aebfxc1ngsg5f5bbimckkjk5exo6vapk" aria-hidden="true" class="crayons-icon"><title id="aebfxc1ngsg5f5bbimckkjk5exo6vapk">Selected Sort Option</title>
    <path d="M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414 4.95 4.95z"></path>
</svg>

       Top
    </div>
     <div id="top-description-text" class="crayons-field__description">
      Most upvoted and relevant comments will be first
    </div>
  </a>
</li>

              <li class="comment-sort-option">
  <a
    href="/kprotty/understanding-atomics-and-memory-ordering-2mom?comments_sort=latest#toggle-comments-sort-dropdown"
    class="comment-sort-option__header pl-7 pb-0 crayons-link--block block"
    aria-describedby="latest-description-text"
    aria-current="">
    <div>
      
       Latest
    </div>
     <div id="latest-description-text" class="crayons-field__description">
      Most recent comments will be first
    </div>
  </a>
</li>

              <li class="comment-sort-option">
  <a
    href="/kprotty/understanding-atomics-and-memory-ordering-2mom?comments_sort=oldest#toggle-comments-sort-dropdown"
    class="comment-sort-option__header pl-7 pb-0 crayons-link--block block"
    aria-describedby="oldest-description-text"
    aria-current="">
    <div>
      
       Oldest
    </div>
     <div id="oldest-description-text" class="crayons-field__description">
      The oldest comments will be first
    </div>
  </a>
</li>

            </ul>
        </nav>

        <div id="comment-subscription" class="print-hidden">
          <div class="crayons-btn-group">
            <span class="crayons-btn crayons-btn--outlined">Subscribe</span>
          </div>
        </div>
      </header>

      <div
        id="comments-container"
        data-testid="comments-container"
        data-commentable-id="659466"
        data-commentable-type="Article"
        data-has-recent-comment-activity="false">

          <div id="response-templates-data" class="hidden"></div>
<script src="https://dev.to/packs/js/runtime~validateFileInputs-5153db5c9cbc3fe78418.js" defer="defer"></script>
<script src="https://dev.to/packs/js/0-6a8935ca6bc68cd25de7.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/1-b4e73c43b525ea3bbdf5.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/validateFileInputs-42ae4068e19b9c96c200.chunk.js" defer="defer"></script>


<form class="comment-form print-hidden" id="new_comment" action="/comments" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" autocomplete="off" />

  <input type="hidden" name="authenticity_token" value="NOTHING" id="new_comment_authenticity_token">

    <input value="659466" autocomplete="off" type="hidden" name="comment[commentable_id]" id="comment_commentable_id" />
    <input value="Article" autocomplete="off" type="hidden" name="comment[commentable_type]" id="comment_commentable_type" />
    

  <span class="crayons-avatar m:crayons-avatar--l mr-2 shrink-0">
    <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--V3djhsWJ--/c_limit,f_auto,fl_progressive,q_auto,w_256/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8j7kvp660rqzt99zui8e.png" width="32" height="32" alt="pic" class="crayons-avatar__image overflow-hidden" id="comment-primary-user-profile--avatar" loading="lazy" />
  </span>
  <div class="comment-form__inner">
    <div class="comment-form__field" data-tracking-name="comment_form_textfield">
      <textarea placeholder="Add to the discussion" onfocus="handleFocus(event)" onkeyup="handleKeyUp(event)" onkeydown="handleKeyDown(event)" oninput="handleChange(event)" id="text-area" required="required" class="crayons-textfield comment-textarea crayons-textfield--ghost" aria-label="Add a comment to the discussion" name="comment[body_markdown]">
</textarea>

    </div>

    <div class="response-templates-container crayons-card crayons-card--secondary p-4 mb-4 comment-form__templates fs-base hidden">
      <header class="mb-3">
        <button type="button" class="crayons-btn personal-template-button active" data-target-type="personal" data-form-id="new_comment">Personal</button>
        <button type="button" class="crayons-btn moderator-template-button hidden" data-target-type="moderator" data-form-id="new_comment">Trusted User</button>
      </header>

      <div class="personal-responses-container">
      </div>
      <div class="moderator-responses-container hidden">
      </div>

      <a target="_blank" rel="noopener nofollow" href="/settings/response-templates">
        Create template
      </a>
      <p>Templates let you quickly answer FAQs or store snippets for re-use.</p>
    </div>

    <div class="comment-form__preview text-styles text-styles--secondary" id="preview-div"></div>

    <div class="comment-form__buttons mb-4">
      <button type="submit" class="crayons-btn mr-2 js-btn-enable" onclick="validateField(event)" data-tracking-name="comment_submit_button" disabled>Submit</button>
      <button type="button" class="preview-toggle crayons-btn crayons-btn--secondary comment-action-preview js-btn-enable mr-2" data-tracking-name="comment_preview_button" disabled>Preview</button>
      <a href="/404.html" class="dismiss-edit-comment crayons-btn crayons-btn--ghost js-btn-dismiss hidden">Dismiss</a>
    </div>
  </div>

  <div class="code-of-conduct" id="toggle-code-of-conduct-checkbox"></div>
</form>


        <div class="comments" id="comment-trees-container">
                <details class="comment-wrapper js-comment-wrapper comment-wrapper--deep-0
                    root
                    " open>
      <summary aria-label="Toggle this comment (and replies)" data-tracking-name="expand_comment_toggle">
        <span class="m:mx-1 inline-block align-middle">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="aoz64jk5nah83fc2lc4mg4hoafivajuu" class="crayons-icon expanded"><title id="aoz64jk5nah83fc2lc4mg4hoafivajuu">Collapse</title>
    <path d="M12 10.677L8 6.935 9 6l3 2.807L15 6l1 .935-4 3.742zm0 4.517L9 18l-1-.935 4-3.742 4 3.742-1 .934-3-2.805z"></path>
</svg>

          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="a7t4x1bre41093ayrucwmjlnjz4iyvvd" class="crayons-icon collapsed"><title id="a7t4x1bre41093ayrucwmjlnjz4iyvvd">Expand</title>
    <path d="M12 18l-4-3.771 1-.943 3 2.829 3-2.829 1 .943L12 18zm0-10.115l-3 2.829-1-.943L12 6l4 3.771-1 .942-3-2.828z"></path>
</svg>

        </span>
        <span class="js-collapse-comment-content inline-block align-middle"></span>
      </summary>
  <div
    id="comment-node-691521"
    class="
      comment single-comment-node
      
      root
      comment--deep-0
      
    "
    data-comment-id="691521"
    data-path="/kprotty/understanding-atomics-and-memory-ordering-2mom/comments/1d8op"
    data-comment-author-id="92569"
    data-content-user-id="92569">
    <a name="comment-1d8op" style="position: absolute; top: -8px;">&nbsp;</a>
    
<div class="comment__inner">
    <a href="https://dev.to/jeikabu" class="shrink-0 crayons-avatar m:crayons-avatar--l mt-4 m:mt-3">
    <img class="crayons-avatar__image" width="32" height="32" src="https://res.cloudinary.com/practicaldev/image/fetch/s--2Dz6wUkX--/c_fill,f_auto,fl_progressive,h_50,q_auto,w_50/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/92569/a8ccdbad-5048-4415-a740-4f7b5d893435.png" alt="jeikabu profile image" loading="lazy" />
  </a>


  <div class="inner-comment comment__details">
    <div class="comment__content crayons-card">
        


        <div class="comment__header">
  <a href="https://dev.to/jeikabu" class="crayons-link crayons-link--secondary flex items-center fw-medium m:hidden">
    <span class="js-comment-username">jeikabu</span>
  </a>
  <div class="profile-preview-card relative mb-4 s:mb-0 fw-medium hidden m:block">
    <button id="comment-profile-preview-trigger-691521" aria-controls="comment-profile-preview-content-691521" class="profile-preview-card__trigger p-1 -my-1 -ml-1 crayons-btn crayons-btn--ghost" aria-label="jeikabu profile details">
      jeikabu
    </button>
    <div id="comment-profile-preview-content-691521" class="profile-preview-card__content p-4 pt-0 branded-7 crayons-dropdown" style="--card-color: #190aa4; border-top-color: var(--card-color);" data-testid="profile-preview-card" data-repositioning-dropdown="true">
    <div class="gap-4 grid">
        <div class="-mt-4">
  <a href="/jeikabu" class="flex">
    <span class="crayons-avatar crayons-avatar--xl  mr-2 shrink-0">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Wv1gu0KV--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/92569/a8ccdbad-5048-4415-a740-4f7b5d893435.png" class="crayons-avatar__image" alt="" loading="lazy" />
    </span>
    <span class="crayons-link crayons-subtitle-2 mt-5">jeikabu</span>
  </a>
</div>

<div class="print-hidden">
  <button name="button" type="button" data-info="{&quot;className&quot;:&quot;User&quot;,&quot;style&quot;:&quot;&quot;,&quot;id&quot;:92569,&quot;name&quot;:&quot;jeikabu&quot;}" class="crayons-btn follow-action-button whitespace-nowrap w-100 follow-user" aria-label="Follow user: jeikabu" aria-pressed="false">Follow</button>
</div>

  <div class="user-metadata-details">
    <ul class="user-metadata-details-inner">
        <li>
          <div class="key">
            Location
          </div>
          <div class="value">
            Santa Clara 
          </div>
        </li>
          <li>
            <div class="key">
              Education
            </div>
            <div class="value">
              M.S.
            </div>
          </li>
      <li>
        <div class="key">
          Joined
        </div>
        <div class="value">
          <time datetime="2018-08-14T02:24:40Z" class="date">Aug 14, 2018</time>
        </div>
      </li>
    </ul>
  </div>

    </div>
</div>

  </div>

  <span class="color-base-30 px-2 m:pl-0" role="presentation">&bull;</span>

<a href="https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom#comment-1d8op" class="comment-date crayons-link crayons-link--secondary fs-s">
  <time datetime="2021-04-09T09:06:03Z" class=date-short-year>
    Apr 9 &#39;21
  </time>

    <span class="hidden m:inline-block">&bull; Edited on <time datetime="2021-04-09T09:14:44Z" class="date-no-year">Apr 9</time></span>
    <span class="m:hidden">&bull; Edited</span>
</a>


  <div class="comment__dropdown" data-tracking-name="comment_dropdown">
    <button id="comment-dropdown-trigger-691521" aria-controls="comment-dropdown-691521" aria-expanded="false"
      class="dropbtn comment__dropdown-trigger crayons-btn crayons-btn--s crayons-btn--ghost crayons-btn--icon "
      aria-label="Toggle dropdown menu" aria-haspopup="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="af3vc3xm8qym0lfday30xwbketvcpt3g" class="crayons-icon pointer-events-none"><title id="af3vc3xm8qym0lfday30xwbketvcpt3g">Dropdown menu</title>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M8.25 12a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm5.25 0a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm3.75 1.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path>
</svg>

    </button>
    <div id="comment-dropdown-691521" class="crayons-dropdown right-1 s:right-0 s:left-auto fs-base dropdown">
      <ul class="m-0">
        <li><a href="https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom#comment-1d8op" class="crayons-link crayons-link--block permalink-copybtn" aria-label="Copy link to jeikabu&#39;s comment" data-no-instant>Copy link</a></li>
        <li class="comment-actions hidden" data-user-id="92569" data-action="settings-button" data-path="https://dev.to/jeikabu/comment/1d8op/settings" aria-label="Go to jeikabu&#39;s comment settings"></li>
          <li class="comment-actions hidden" data-action="hide-button" data-commentable-user-id="610982" data-user-id="92569">
              <button
                class="flex justify-between crayons-link crayons-link--block w-100 bg-transparent border-0 hide-comment"
                data-hide-type="hide"
                data-comment-id="691521"
                data-comment-url="https://dev.to/jeikabu/comment/1d8op"
                aria-label="Hide jeikabu&#39;s comment">
                Hide
              </button>
          </li>
        <li class="mod-actions hidden mod-actions-comment-button" data-path="https://dev.to/jeikabu/comment/1d8op/mod" aria-label="Moderate jeikabu&#39;s comment"></li>
        <li class="report-abuse-link-wrapper" data-path="/report-abuse?url=https://dev.to/jeikabu/comment/1d8op" aria-label="Report jeikabu&#39;s comment as abusive or violating our code of conduct and/or terms and conditions"></li>
        <li class="current-user-actions"></li>
      </ul>
    </div>
  </div>
</div>


        <div
          class="
            comment__body
            text-styles
            text-styles--secondary
            body
            
            
          ">
          <p>Pretty well-written, accessible article of a tricky subject. The exception being the last paragraph before the conclusion where you mention "full barrier" and "write-combined memory".  I'm guessing that will baffle some people. But, it would have made the post much longer...</p>

<p>But great post overall!  Synchronization is a fascinating subject that I feel is poorly understood and doesn't get enough attention.  Further reading on lock-free data-structures, the ABA problem, dealing with hw/sw interrupts, spin-locks, priority inversion, and so on.  See, I'm excited, is everyone else?  😁</p>


        </div>

    </div>

    <footer class="comment__footer print-hidden">
  <button
    class="crayons-tooltip__activator crayons-btn crayons-btn--ghost crayons-btn--icon-left crayons-btn--s mr-1 reaction-like inline-flex reaction-button"
    id="button-for-comment-691521"
    data-comment-id="691521"
    aria-label="like"
    data-tracking-name="comment_heart_button">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" role="img" aria-labelledby="a3xwxk62wc7xs30wsa97bt4hzitbsgm1" class="crayons-icon reaction-icon not-reacted"><title id="a3xwxk62wc7xs30wsa97bt4hzitbsgm1">Like comment: </title><path d="M18.884 12.595l.01.011L12 19.5l-6.894-6.894.01-.01A4.875 4.875 0 0112 5.73a4.875 4.875 0 016.884 6.865zM6.431 7.037a3.375 3.375 0 000 4.773L12 17.38l5.569-5.569a3.375 3.375 0 10-4.773-4.773L9.613 10.22l-1.06-1.062 2.371-2.372a3.375 3.375 0 00-4.492.25v.001z"></path></svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="a5wi1dq30smzipxd8hyoabx9fff1cfpy" class="crayons-icon crayons-icon reaction-icon--like reaction-icon reacted"><title id="a5wi1dq30smzipxd8hyoabx9fff1cfpy">Like comment: </title>
    <path d="M5.116 12.595a4.875 4.875 0 015.56-7.68h-.002L7.493 8.098l1.06 1.061 3.181-3.182a4.875 4.875 0 016.895 6.894L12 19.5l-6.894-6.894.01-.01z"></path>
</svg>

    <span class="reactions-count">2</span><span class="reactions-label hidden m:inline-block">&nbsp;likes</span>
    <span data-testid="tooltip" class="crayons-tooltip__content">
      Like
    </span>
  </button>

      <a
        class="actions crayons-btn crayons-btn--ghost crayons-btn--s crayons-btn--icon-left toggle-reply-form mr-1 inline-flex"
        href="#/kprotty/understanding-atomics-and-memory-ordering-2mom/comments/new/1d8op"
        data-comment-id="691521"
        data-path="/kprotty/understanding-atomics-and-memory-ordering-2mom/comments/1d8op"
        data-tracking-name="comment_reply_button"
        data-testid="reply-button-691521"
        rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" role="img" aria-labelledby="asndzi9tgf4yw0esbiccnhkir5k3m9ec" class="crayons-icon reaction-icon not-reacted"><title id="asndzi9tgf4yw0esbiccnhkir5k3m9ec">Comment button</title><path d="M10.5 5h3a6 6 0 110 12v2.625c-3.75-1.5-9-3.75-9-8.625a6 6 0 016-6zM12 15.5h1.5a4.501 4.501 0 001.722-8.657A4.5 4.5 0 0013.5 6.5h-3A4.5 4.5 0 006 11c0 2.707 1.846 4.475 6 6.36V15.5z"></path></svg>

        <span class="hidden m:inline-block">Reply</span>
      </a>

</footer>

  </div>
</div>


  </div>
    </details>

    <details class="comment-wrapper js-comment-wrapper comment-wrapper--deep-0
                    root
                    " open>
      <summary aria-label="Toggle this comment (and replies)" data-tracking-name="expand_comment_toggle">
        <span class="m:mx-1 inline-block align-middle">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="a3vjddxfgx1ofs91tmbl40su2i53cya1" class="crayons-icon expanded"><title id="a3vjddxfgx1ofs91tmbl40su2i53cya1">Collapse</title>
    <path d="M12 10.677L8 6.935 9 6l3 2.807L15 6l1 .935-4 3.742zm0 4.517L9 18l-1-.935 4-3.742 4 3.742-1 .934-3-2.805z"></path>
</svg>

          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="amg4tqppmth27g2n28snaney1fsnc694" class="crayons-icon collapsed"><title id="amg4tqppmth27g2n28snaney1fsnc694">Expand</title>
    <path d="M12 18l-4-3.771 1-.943 3 2.829 3-2.829 1 .943L12 18zm0-10.115l-3 2.829-1-.943L12 6l4 3.771-1 .942-3-2.828z"></path>
</svg>

        </span>
        <span class="js-collapse-comment-content inline-block align-middle"></span>
      </summary>
  <div
    id="comment-node-756590"
    class="
      comment single-comment-node
      
      root
      comment--deep-0
      
    "
    data-comment-id="756590"
    data-path="/kprotty/understanding-atomics-and-memory-ordering-2mom/comments/1h15g"
    data-comment-author-id="681046"
    data-content-user-id="681046">
    <a name="comment-1h15g" style="position: absolute; top: -8px;">&nbsp;</a>
    
<div class="comment__inner">
    <a href="https://dev.to/nd" class="shrink-0 crayons-avatar m:crayons-avatar--l mt-4 m:mt-3">
    <img class="crayons-avatar__image" width="32" height="32" src="https://res.cloudinary.com/practicaldev/image/fetch/s--5ceUi-Cb--/c_fill,f_auto,fl_progressive,h_50,q_auto,w_50/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/681046/64660248-80da-4d56-a9a4-3a5942a7ce75.png" alt="nd profile image" loading="lazy" />
  </a>


  <div class="inner-comment comment__details">
    <div class="comment__content crayons-card">
        


        <div class="comment__header">
  <a href="https://dev.to/nd" class="crayons-link crayons-link--secondary flex items-center fw-medium m:hidden">
    <span class="js-comment-username">nd</span>
  </a>
  <div class="profile-preview-card relative mb-4 s:mb-0 fw-medium hidden m:block">
    <button id="comment-profile-preview-trigger-756590" aria-controls="comment-profile-preview-content-756590" class="profile-preview-card__trigger p-1 -my-1 -ml-1 crayons-btn crayons-btn--ghost" aria-label="nd profile details">
      nd
    </button>
    <div id="comment-profile-preview-content-756590" class="profile-preview-card__content p-4 pt-0 branded-7 crayons-dropdown" style="--card-color: #000000; border-top-color: var(--card-color);" data-testid="profile-preview-card" data-repositioning-dropdown="true">
    <div class="gap-4 grid">
        <div class="-mt-4">
  <a href="/nd" class="flex">
    <span class="crayons-avatar crayons-avatar--xl  mr-2 shrink-0">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--WLAhly8P--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/681046/64660248-80da-4d56-a9a4-3a5942a7ce75.png" class="crayons-avatar__image" alt="" loading="lazy" />
    </span>
    <span class="crayons-link crayons-subtitle-2 mt-5">nd</span>
  </a>
</div>

<div class="print-hidden">
  <button name="button" type="button" data-info="{&quot;className&quot;:&quot;User&quot;,&quot;style&quot;:&quot;&quot;,&quot;id&quot;:681046,&quot;name&quot;:&quot;nd&quot;}" class="crayons-btn follow-action-button whitespace-nowrap w-100 follow-user" aria-label="Follow user: nd" aria-pressed="false">Follow</button>
</div>

  <div class="user-metadata-details">
    <ul class="user-metadata-details-inner">
      <li>
        <div class="key">
          Joined
        </div>
        <div class="value">
          <time datetime="2021-08-06T06:28:19Z" class="date">Aug 6, 2021</time>
        </div>
      </li>
    </ul>
  </div>

    </div>
</div>

  </div>

  <span class="color-base-30 px-2 m:pl-0" role="presentation">&bull;</span>

<a href="https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom#comment-1h15g" class="comment-date crayons-link crayons-link--secondary fs-s">
  <time datetime="2021-08-06T06:29:53Z" class=date-short-year>
    Aug 6 &#39;21
  </time>

</a>


  <div class="comment__dropdown" data-tracking-name="comment_dropdown">
    <button id="comment-dropdown-trigger-756590" aria-controls="comment-dropdown-756590" aria-expanded="false"
      class="dropbtn comment__dropdown-trigger crayons-btn crayons-btn--s crayons-btn--ghost crayons-btn--icon "
      aria-label="Toggle dropdown menu" aria-haspopup="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="a2w59qpg1fthetma6q372k8x91f28x9p" class="crayons-icon pointer-events-none"><title id="a2w59qpg1fthetma6q372k8x91f28x9p">Dropdown menu</title>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M8.25 12a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm5.25 0a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm3.75 1.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path>
</svg>

    </button>
    <div id="comment-dropdown-756590" class="crayons-dropdown right-1 s:right-0 s:left-auto fs-base dropdown">
      <ul class="m-0">
        <li><a href="https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom#comment-1h15g" class="crayons-link crayons-link--block permalink-copybtn" aria-label="Copy link to nd&#39;s comment" data-no-instant>Copy link</a></li>
        <li class="comment-actions hidden" data-user-id="681046" data-action="settings-button" data-path="https://dev.to/nd/comment/1h15g/settings" aria-label="Go to nd&#39;s comment settings"></li>
          <li class="comment-actions hidden" data-action="hide-button" data-commentable-user-id="610982" data-user-id="681046">
              <button
                class="flex justify-between crayons-link crayons-link--block w-100 bg-transparent border-0 hide-comment"
                data-hide-type="hide"
                data-comment-id="756590"
                data-comment-url="https://dev.to/nd/comment/1h15g"
                aria-label="Hide nd&#39;s comment">
                Hide
              </button>
          </li>
        <li class="mod-actions hidden mod-actions-comment-button" data-path="https://dev.to/nd/comment/1h15g/mod" aria-label="Moderate nd&#39;s comment"></li>
        <li class="report-abuse-link-wrapper" data-path="/report-abuse?url=https://dev.to/nd/comment/1h15g" aria-label="Report nd&#39;s comment as abusive or violating our code of conduct and/or terms and conditions"></li>
        <li class="current-user-actions"></li>
      </ul>
    </div>
  </div>
</div>


        <div
          class="
            comment__body
            text-styles
            text-styles--secondary
            body
            
            
          ">
          <p>Trying to wrap my head around fences.</p>

<p>Shouldn't ordering be the following?</p>

<p>A fence(Release) makes <strong>previous</strong> non-Release atomic stores into Release if they have a matching Acquire atomic load or matching fence(Acquire).</p>

<p>A fence(Acquire) makes <strong>subsequent</strong> non-Acquire atomic loads into Acquire if they have a matching Release atomic store or matching fence(Release).</p>


        </div>

    </div>

    <footer class="comment__footer print-hidden">
  <button
    class="crayons-tooltip__activator crayons-btn crayons-btn--ghost crayons-btn--icon-left crayons-btn--s mr-1 reaction-like inline-flex reaction-button"
    id="button-for-comment-756590"
    data-comment-id="756590"
    aria-label="like"
    data-tracking-name="comment_heart_button">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" role="img" aria-labelledby="at8994si553n2zu6wjfd6qbzwa6y9xi5" class="crayons-icon reaction-icon not-reacted"><title id="at8994si553n2zu6wjfd6qbzwa6y9xi5">Like comment: </title><path d="M18.884 12.595l.01.011L12 19.5l-6.894-6.894.01-.01A4.875 4.875 0 0112 5.73a4.875 4.875 0 016.884 6.865zM6.431 7.037a3.375 3.375 0 000 4.773L12 17.38l5.569-5.569a3.375 3.375 0 10-4.773-4.773L9.613 10.22l-1.06-1.062 2.371-2.372a3.375 3.375 0 00-4.492.25v.001z"></path></svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="aimlc6j5d68qzp0h663sjghkstsjgk3x" class="crayons-icon crayons-icon reaction-icon--like reaction-icon reacted"><title id="aimlc6j5d68qzp0h663sjghkstsjgk3x">Like comment: </title>
    <path d="M5.116 12.595a4.875 4.875 0 015.56-7.68h-.002L7.493 8.098l1.06 1.061 3.181-3.182a4.875 4.875 0 016.895 6.894L12 19.5l-6.894-6.894.01-.01z"></path>
</svg>

    <span class="reactions-count">1</span><span class="reactions-label hidden m:inline-block">&nbsp;like</span>
    <span data-testid="tooltip" class="crayons-tooltip__content">
      Like
    </span>
  </button>

      <a
        class="actions crayons-btn crayons-btn--ghost crayons-btn--s crayons-btn--icon-left toggle-reply-form mr-1 inline-flex"
        href="#/kprotty/understanding-atomics-and-memory-ordering-2mom/comments/new/1h15g"
        data-comment-id="756590"
        data-path="/kprotty/understanding-atomics-and-memory-ordering-2mom/comments/1h15g"
        data-tracking-name="comment_reply_button"
        data-testid="reply-button-756590"
        rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" role="img" aria-labelledby="ab10c4lem4u8s1c21jsuiba82f9mp648" class="crayons-icon reaction-icon not-reacted"><title id="ab10c4lem4u8s1c21jsuiba82f9mp648">Comment button</title><path d="M10.5 5h3a6 6 0 110 12v2.625c-3.75-1.5-9-3.75-9-8.625a6 6 0 016-6zM12 15.5h1.5a4.501 4.501 0 001.722-8.657A4.5 4.5 0 0013.5 6.5h-3A4.5 4.5 0 006 11c0 2.707 1.846 4.475 6 6.36V15.5z"></path></svg>

        <span class="hidden m:inline-block">Reply</span>
      </a>

</footer>

  </div>
</div>
    <details class="comment-wrapper js-comment-wrapper comment-wrapper--deep-1
                    child
                    " open>
      <summary aria-label="Toggle this comment (and replies)" data-tracking-name="expand_comment_toggle">
        <span class="mx-0 inline-block align-middle">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="a3xvrdtm7b3nc3y40dbklkvxm99rdzny" class="crayons-icon expanded"><title id="a3xvrdtm7b3nc3y40dbklkvxm99rdzny">Collapse</title>
    <path d="M12 10.677L8 6.935 9 6l3 2.807L15 6l1 .935-4 3.742zm0 4.517L9 18l-1-.935 4-3.742 4 3.742-1 .934-3-2.805z"></path>
</svg>

          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="a62daue6n7q38ft1d5tpj3fjg7ukesis" class="crayons-icon collapsed"><title id="a62daue6n7q38ft1d5tpj3fjg7ukesis">Expand</title>
    <path d="M12 18l-4-3.771 1-.943 3 2.829 3-2.829 1 .943L12 18zm0-10.115l-3 2.829-1-.943L12 6l4 3.771-1 .942-3-2.828z"></path>
</svg>

        </span>
        <span class="js-collapse-comment-content inline-block align-middle"></span>
      </summary>
  <div
    id="comment-node-758107"
    class="
      comment single-comment-node
      
      child
      comment--deep-1
      
    "
    data-comment-id="758107"
    data-path="/kprotty/understanding-atomics-and-memory-ordering-2mom/comments/1h3bp"
    data-comment-author-id="610982"
    data-content-user-id="610982">
    <a name="comment-1h3bp" style="position: absolute; top: -8px;">&nbsp;</a>
    
<div class="comment__inner">
    <a href="https://dev.to/kprotty" class="shrink-0 crayons-avatar mt-4">
    <img class="crayons-avatar__image" width="32" height="32" src="https://res.cloudinary.com/practicaldev/image/fetch/s--I28RC1Py--/c_fill,f_auto,fl_progressive,h_50,q_auto,w_50/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/610982/4489bc94-50d9-4aa7-9364-e38f3d3d9258.jpeg" alt="kprotty profile image" loading="lazy" />
  </a>


  <div class="inner-comment comment__details">
    <div class="comment__content crayons-card">
        


        <div class="comment__header">
  <a href="https://dev.to/kprotty" class="crayons-link crayons-link--secondary flex items-center fw-medium m:hidden">
    <span class="js-comment-username">kprotty</span>
      <span class="crayons-hover-tooltip inline-block spec-op-author -mr-2" data-tooltip="Author">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" class="crayons-icon">
    <path d="M12 8.25a6 6 0 110 12 6 6 0 010-12zm0 2.625l-.992 2.01-2.218.322 1.605 1.564-.379 2.21L12 15.937l1.984 1.043-.379-2.209 1.605-1.564-2.218-.323L12 10.875zm.75-6.376l3.75.001v2.25l-1.022.854a7.45 7.45 0 00-2.728-.817V4.5zm-1.5 0v2.288a7.451 7.451 0 00-2.727.816L7.5 6.75V4.5h3.75z"></path>
</svg>

      </span>
  </a>
  <div class="profile-preview-card relative mb-4 s:mb-0 fw-medium hidden m:block">
    <button id="comment-profile-preview-trigger-758107" aria-controls="comment-profile-preview-content-758107" class="profile-preview-card__trigger p-1 -my-1 -ml-1 crayons-btn crayons-btn--ghost" aria-label="kprotty profile details">
      kprotty
    </button>
    <div id="comment-profile-preview-content-758107" class="profile-preview-card__content p-4 pt-0 branded-7 crayons-dropdown" style="--card-color: #000000; border-top-color: var(--card-color);" data-testid="profile-preview-card" data-repositioning-dropdown="true">
    <div class="gap-4 grid">
        <div class="-mt-4">
  <a href="/kprotty" class="flex">
    <span class="crayons-avatar crayons-avatar--xl  mr-2 shrink-0">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ZKXQlQ-s--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/610982/4489bc94-50d9-4aa7-9364-e38f3d3d9258.jpeg" class="crayons-avatar__image" alt="" loading="lazy" />
    </span>
    <span class="crayons-link crayons-subtitle-2 mt-5">kprotty</span>
  </a>
</div>

<div class="print-hidden">
  <button name="button" type="button" data-info="{&quot;className&quot;:&quot;User&quot;,&quot;style&quot;:&quot;&quot;,&quot;id&quot;:610982,&quot;name&quot;:&quot;kprotty&quot;}" class="crayons-btn follow-action-button whitespace-nowrap w-100 follow-user" aria-label="Follow user: kprotty" aria-pressed="false">Follow</button>
</div>
  <div class="color-base-70">
    None
  </div>

  <div class="user-metadata-details">
    <ul class="user-metadata-details-inner">
        <li>
          <div class="key">
            Location
          </div>
          <div class="value">
            None 
          </div>
        </li>
      <li>
        <div class="key">
          Joined
        </div>
        <div class="value">
          <time datetime="2021-04-08T23:54:21Z" class="date">Apr 8, 2021</time>
        </div>
      </li>
    </ul>
  </div>

    </div>
</div>

      <span class="crayons-hover-tooltip inline-block spec-op-author -ml-2" data-tooltip="Author">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" class="crayons-icon">
    <path d="M12 8.25a6 6 0 110 12 6 6 0 010-12zm0 2.625l-.992 2.01-2.218.322 1.605 1.564-.379 2.21L12 15.937l1.984 1.043-.379-2.209 1.605-1.564-2.218-.323L12 10.875zm.75-6.376l3.75.001v2.25l-1.022.854a7.45 7.45 0 00-2.728-.817V4.5zm-1.5 0v2.288a7.451 7.451 0 00-2.727.816L7.5 6.75V4.5h3.75z"></path>
</svg>

      </span>
  </div>

  <span class="color-base-30 px-2 m:pl-0" role="presentation">&bull;</span>

<a href="https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom#comment-1h3bp" class="comment-date crayons-link crayons-link--secondary fs-s">
  <time datetime="2021-08-09T04:19:53Z" class=date-short-year>
    Aug 9 &#39;21
  </time>

</a>


  <div class="comment__dropdown" data-tracking-name="comment_dropdown">
    <button id="comment-dropdown-trigger-758107" aria-controls="comment-dropdown-758107" aria-expanded="false"
      class="dropbtn comment__dropdown-trigger crayons-btn crayons-btn--s crayons-btn--ghost crayons-btn--icon "
      aria-label="Toggle dropdown menu" aria-haspopup="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="ai1yrcdhzcei4qma1yt8h8fl1r1b7fx1" class="crayons-icon pointer-events-none"><title id="ai1yrcdhzcei4qma1yt8h8fl1r1b7fx1">Dropdown menu</title>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M8.25 12a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm5.25 0a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm3.75 1.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path>
</svg>

    </button>
    <div id="comment-dropdown-758107" class="crayons-dropdown right-1 s:right-0 s:left-auto fs-base dropdown">
      <ul class="m-0">
        <li><a href="https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom#comment-1h3bp" class="crayons-link crayons-link--block permalink-copybtn" aria-label="Copy link to kprotty&#39;s comment" data-no-instant>Copy link</a></li>
        <li class="comment-actions hidden" data-user-id="610982" data-action="settings-button" data-path="https://dev.to/kprotty/comment/1h3bp/settings" aria-label="Go to kprotty&#39;s comment settings"></li>
          <li class="comment-actions hidden" data-action="hide-button" data-commentable-user-id="610982" data-user-id="610982">
              <button
                class="flex justify-between crayons-link crayons-link--block w-100 bg-transparent border-0 hide-comment"
                data-hide-type="hide"
                data-comment-id="758107"
                data-comment-url="https://dev.to/kprotty/comment/1h3bp"
                aria-label="Hide kprotty&#39;s comment">
                Hide
              </button>
          </li>
        <li class="mod-actions hidden mod-actions-comment-button" data-path="https://dev.to/kprotty/comment/1h3bp/mod" aria-label="Moderate kprotty&#39;s comment"></li>
        <li class="report-abuse-link-wrapper" data-path="/report-abuse?url=https://dev.to/kprotty/comment/1h3bp" aria-label="Report kprotty&#39;s comment as abusive or violating our code of conduct and/or terms and conditions"></li>
        <li class="current-user-actions"></li>
      </ul>
    </div>
  </div>
</div>


        <div
          class="
            comment__body
            text-styles
            text-styles--secondary
            body
            
            
          ">
          <p>I don't think so: <code>write(); fence(Release); store()</code> under those rules would imply that the write() is <code>Release</code> when in-fact the store() might be the one that is used to observe the contents of the write(), meaning the store() would have to be <code>Release</code>. </p>

<p>"Promoting the store() to Release" might be the wrong imagery to use on my part. The <a href="https://en.cppreference.com/w/cpp/atomic/atomic_thread_fence" rel="nofollow">C++ Atomics Reference</a> describes it much more concretely:</p>

<blockquote>
<p>A release fence F in thread A synchronizes-with atomic acquire operation Y in thread B, if:</p>

<ul>
<li>there exists an atomic store X (with any memory order)</li>
<li>F is <strong>sequenced-before</strong> X in thread A</li>
</ul>
</blockquote>


        </div>

    </div>

    <footer class="comment__footer print-hidden">
  <button
    class="crayons-tooltip__activator crayons-btn crayons-btn--ghost crayons-btn--icon-left crayons-btn--s mr-1 reaction-like inline-flex reaction-button"
    id="button-for-comment-758107"
    data-comment-id="758107"
    aria-label="like"
    data-tracking-name="comment_heart_button">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" role="img" aria-labelledby="ak220purekts5693zloz6b9jm707p462" class="crayons-icon reaction-icon not-reacted"><title id="ak220purekts5693zloz6b9jm707p462">Like comment: </title><path d="M18.884 12.595l.01.011L12 19.5l-6.894-6.894.01-.01A4.875 4.875 0 0112 5.73a4.875 4.875 0 016.884 6.865zM6.431 7.037a3.375 3.375 0 000 4.773L12 17.38l5.569-5.569a3.375 3.375 0 10-4.773-4.773L9.613 10.22l-1.06-1.062 2.371-2.372a3.375 3.375 0 00-4.492.25v.001z"></path></svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="aotradcsy4iufx25rww7na5m0qw783np" class="crayons-icon crayons-icon reaction-icon--like reaction-icon reacted"><title id="aotradcsy4iufx25rww7na5m0qw783np">Like comment: </title>
    <path d="M5.116 12.595a4.875 4.875 0 015.56-7.68h-.002L7.493 8.098l1.06 1.061 3.181-3.182a4.875 4.875 0 016.895 6.894L12 19.5l-6.894-6.894.01-.01z"></path>
</svg>

    <span class="reactions-count">1</span><span class="reactions-label hidden m:inline-block">&nbsp;like</span>
    <span data-testid="tooltip" class="crayons-tooltip__content">
      Like
    </span>
  </button>

      <a
        class="actions crayons-btn crayons-btn--ghost crayons-btn--s crayons-btn--icon-left toggle-reply-form mr-1 inline-flex"
        href="#/kprotty/understanding-atomics-and-memory-ordering-2mom/comments/new/1h3bp"
        data-comment-id="758107"
        data-path="/kprotty/understanding-atomics-and-memory-ordering-2mom/comments/1h3bp"
        data-tracking-name="comment_reply_button"
        data-testid="reply-button-758107"
        rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" role="img" aria-labelledby="alid682gl6mjl4zuorbal4p9k7fcfh6h" class="crayons-icon reaction-icon not-reacted"><title id="alid682gl6mjl4zuorbal4p9k7fcfh6h">Comment button</title><path d="M10.5 5h3a6 6 0 110 12v2.625c-3.75-1.5-9-3.75-9-8.625a6 6 0 016-6zM12 15.5h1.5a4.501 4.501 0 001.722-8.657A4.5 4.5 0 0013.5 6.5h-3A4.5 4.5 0 006 11c0 2.707 1.846 4.475 6 6.36V15.5z"></path></svg>

        <span class="hidden m:inline-block">Reply</span>
      </a>

</footer>

  </div>
</div>


  </div>
    </details>


  </div>
    </details>

    <details class="comment-wrapper js-comment-wrapper comment-wrapper--deep-0
                    root
                    " open>
      <summary aria-label="Toggle this comment (and replies)" data-tracking-name="expand_comment_toggle">
        <span class="m:mx-1 inline-block align-middle">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="ab347d5o3xzkqfz8zh2ciub3tqxnv5ag" class="crayons-icon expanded"><title id="ab347d5o3xzkqfz8zh2ciub3tqxnv5ag">Collapse</title>
    <path d="M12 10.677L8 6.935 9 6l3 2.807L15 6l1 .935-4 3.742zm0 4.517L9 18l-1-.935 4-3.742 4 3.742-1 .934-3-2.805z"></path>
</svg>

          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="a16ceji82sts6tre2ex47r5gfuutibc5" class="crayons-icon collapsed"><title id="a16ceji82sts6tre2ex47r5gfuutibc5">Expand</title>
    <path d="M12 18l-4-3.771 1-.943 3 2.829 3-2.829 1 .943L12 18zm0-10.115l-3 2.829-1-.943L12 6l4 3.771-1 .942-3-2.828z"></path>
</svg>

        </span>
        <span class="js-collapse-comment-content inline-block align-middle"></span>
      </summary>
  <div
    id="comment-node-961904"
    class="
      comment single-comment-node
      
      root
      comment--deep-0
      
    "
    data-comment-id="961904"
    data-path="/kprotty/understanding-atomics-and-memory-ordering-2mom/comments/22io8"
    data-comment-author-id="130577"
    data-content-user-id="130577">
    <a name="comment-22io8" style="position: absolute; top: -8px;">&nbsp;</a>
    
<div class="comment__inner">
    <a href="https://dev.to/gberthiaume" class="shrink-0 crayons-avatar m:crayons-avatar--l mt-4 m:mt-3">
    <img class="crayons-avatar__image" width="32" height="32" src="https://res.cloudinary.com/practicaldev/image/fetch/s--zT898ZYT--/c_fill,f_auto,fl_progressive,h_50,q_auto,w_50/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/130577/29e72aff-28d9-4fb5-b6f9-0589aa8ca76c.jpg" alt="gberthiaume profile image" loading="lazy" />
  </a>


  <div class="inner-comment comment__details">
    <div class="comment__content crayons-card">
        


        <div class="comment__header">
  <a href="https://dev.to/gberthiaume" class="crayons-link crayons-link--secondary flex items-center fw-medium m:hidden">
    <span class="js-comment-username">G. Berthiaume</span>
  </a>
  <div class="profile-preview-card relative mb-4 s:mb-0 fw-medium hidden m:block">
    <button id="comment-profile-preview-trigger-961904" aria-controls="comment-profile-preview-content-961904" class="profile-preview-card__trigger p-1 -my-1 -ml-1 crayons-btn crayons-btn--ghost" aria-label="G. Berthiaume profile details">
      G. Berthiaume
    </button>
    <div id="comment-profile-preview-content-961904" class="profile-preview-card__content p-4 pt-0 branded-7 crayons-dropdown" style="--card-color: #bdc3c7; border-top-color: var(--card-color);" data-testid="profile-preview-card" data-repositioning-dropdown="true">
    <div class="gap-4 grid">
        <div class="-mt-4">
  <a href="/gberthiaume" class="flex">
    <span class="crayons-avatar crayons-avatar--xl  mr-2 shrink-0">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--C-vviZgr--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/130577/29e72aff-28d9-4fb5-b6f9-0589aa8ca76c.jpg" class="crayons-avatar__image" alt="" loading="lazy" />
    </span>
    <span class="crayons-link crayons-subtitle-2 mt-5">G. Berthiaume</span>
  </a>
</div>

<div class="print-hidden">
  <button name="button" type="button" data-info="{&quot;className&quot;:&quot;User&quot;,&quot;style&quot;:&quot;&quot;,&quot;id&quot;:130577,&quot;name&quot;:&quot;G. Berthiaume&quot;}" class="crayons-btn follow-action-button whitespace-nowrap w-100 follow-user" aria-label="Follow user: G. Berthiaume" aria-pressed="false">Follow</button>
</div>
  <div class="color-base-70">
    I&#39;m in tech for the beauty.
  </div>

  <div class="user-metadata-details">
    <ul class="user-metadata-details-inner">
        <li>
          <div class="key">
            Location
          </div>
          <div class="value">
            Montréal
          </div>
        </li>
          <li>
            <div class="key">
              Work
            </div>
            <div class="value">
              Electrical Engineer
            </div>
          </li>
      <li>
        <div class="key">
          Joined
        </div>
        <div class="value">
          <time datetime="2019-01-21T02:13:08Z" class="date">Jan 21, 2019</time>
        </div>
      </li>
    </ul>
  </div>

    </div>
</div>

  </div>

  <span class="color-base-30 px-2 m:pl-0" role="presentation">&bull;</span>

<a href="https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom#comment-22io8" class="comment-date crayons-link crayons-link--secondary fs-s">
  <time datetime="2022-11-01T15:14:42Z" class=date-short-year>
    Nov 1 &#39;22
  </time>

</a>


  <div class="comment__dropdown" data-tracking-name="comment_dropdown">
    <button id="comment-dropdown-trigger-961904" aria-controls="comment-dropdown-961904" aria-expanded="false"
      class="dropbtn comment__dropdown-trigger crayons-btn crayons-btn--s crayons-btn--ghost crayons-btn--icon "
      aria-label="Toggle dropdown menu" aria-haspopup="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="acc5m8qypffek513liybbyukg8i8w5jm" class="crayons-icon pointer-events-none"><title id="acc5m8qypffek513liybbyukg8i8w5jm">Dropdown menu</title>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M8.25 12a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm5.25 0a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm3.75 1.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path>
</svg>

    </button>
    <div id="comment-dropdown-961904" class="crayons-dropdown right-1 s:right-0 s:left-auto fs-base dropdown">
      <ul class="m-0">
        <li><a href="https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom#comment-22io8" class="crayons-link crayons-link--block permalink-copybtn" aria-label="Copy link to G. Berthiaume&#39;s comment" data-no-instant>Copy link</a></li>
        <li class="comment-actions hidden" data-user-id="130577" data-action="settings-button" data-path="https://dev.to/gberthiaume/comment/22io8/settings" aria-label="Go to G. Berthiaume&#39;s comment settings"></li>
          <li class="comment-actions hidden" data-action="hide-button" data-commentable-user-id="610982" data-user-id="130577">
              <button
                class="flex justify-between crayons-link crayons-link--block w-100 bg-transparent border-0 hide-comment"
                data-hide-type="hide"
                data-comment-id="961904"
                data-comment-url="https://dev.to/gberthiaume/comment/22io8"
                aria-label="Hide G. Berthiaume&#39;s comment">
                Hide
              </button>
          </li>
        <li class="mod-actions hidden mod-actions-comment-button" data-path="https://dev.to/gberthiaume/comment/22io8/mod" aria-label="Moderate G. Berthiaume&#39;s comment"></li>
        <li class="report-abuse-link-wrapper" data-path="/report-abuse?url=https://dev.to/gberthiaume/comment/22io8" aria-label="Report G. Berthiaume&#39;s comment as abusive or violating our code of conduct and/or terms and conditions"></li>
        <li class="current-user-actions"></li>
      </ul>
    </div>
  </div>
</div>


        <div
          class="
            comment__body
            text-styles
            text-styles--secondary
            body
            
            
          ">
          <p>Thanks for writing this article. <br>
It's a pleasure to see advanced topics on dev.to.</p>


        </div>

    </div>

    <footer class="comment__footer print-hidden">
  <button
    class="crayons-tooltip__activator crayons-btn crayons-btn--ghost crayons-btn--icon-left crayons-btn--s mr-1 reaction-like inline-flex reaction-button"
    id="button-for-comment-961904"
    data-comment-id="961904"
    aria-label="like"
    data-tracking-name="comment_heart_button">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" role="img" aria-labelledby="aq1krc5t00nya1z2mhtjrtopzy41v0bu" class="crayons-icon reaction-icon not-reacted"><title id="aq1krc5t00nya1z2mhtjrtopzy41v0bu">Like comment: </title><path d="M18.884 12.595l.01.011L12 19.5l-6.894-6.894.01-.01A4.875 4.875 0 0112 5.73a4.875 4.875 0 016.884 6.865zM6.431 7.037a3.375 3.375 0 000 4.773L12 17.38l5.569-5.569a3.375 3.375 0 10-4.773-4.773L9.613 10.22l-1.06-1.062 2.371-2.372a3.375 3.375 0 00-4.492.25v.001z"></path></svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" role="img" aria-labelledby="af5vv2jyn7ntxthye2mesfc0th3ioxnz" class="crayons-icon crayons-icon reaction-icon--like reaction-icon reacted"><title id="af5vv2jyn7ntxthye2mesfc0th3ioxnz">Like comment: </title>
    <path d="M5.116 12.595a4.875 4.875 0 015.56-7.68h-.002L7.493 8.098l1.06 1.061 3.181-3.182a4.875 4.875 0 016.895 6.894L12 19.5l-6.894-6.894.01-.01z"></path>
</svg>

    <span class="reactions-count">1</span><span class="reactions-label hidden m:inline-block">&nbsp;like</span>
    <span data-testid="tooltip" class="crayons-tooltip__content">
      Like
    </span>
  </button>

      <a
        class="actions crayons-btn crayons-btn--ghost crayons-btn--s crayons-btn--icon-left toggle-reply-form mr-1 inline-flex"
        href="#/kprotty/understanding-atomics-and-memory-ordering-2mom/comments/new/22io8"
        data-comment-id="961904"
        data-path="/kprotty/understanding-atomics-and-memory-ordering-2mom/comments/22io8"
        data-tracking-name="comment_reply_button"
        data-testid="reply-button-961904"
        rel="nofollow">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" role="img" aria-labelledby="a65rqjts5o2ozctjtb162xk2bn1hx61u" class="crayons-icon reaction-icon not-reacted"><title id="a65rqjts5o2ozctjtb162xk2bn1hx61u">Comment button</title><path d="M10.5 5h3a6 6 0 110 12v2.625c-3.75-1.5-9-3.75-9-8.625a6 6 0 016-6zM12 15.5h1.5a4.501 4.501 0 001.722-8.657A4.5 4.5 0 0013.5 6.5h-3A4.5 4.5 0 006 11c0 2.707 1.846 4.475 6 6.36V15.5z"></path></svg>

        <span class="hidden m:inline-block">Reply</span>
      </a>

</footer>

  </div>
</div>


  </div>
    </details>


        </div>
      </div>

      <div class="align-center">


  <nav class="fs-s align-center block" aria-label="Conduct controls">
  <a href="/code-of-conduct" class="crayons-link crayons-link--secondary">Code of Conduct</a>
  <span class="opacity-25 px-2" role="presentation">&bull;</span>
  <a href="/report-abuse" class="crayons-link crayons-link--secondary">Report abuse</a>
</nav>

</div>

  </section>
  <div id="hide-comments-modal" class="hidden">
  <form id="hide-comments-modal__form" class="hide-comments-modal__form" data-type="json" action="/comments/hide" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" autocomplete="off" /><input type="hidden" name="_method" value="patch" autocomplete="off" /><input type="hidden" name="authenticity_token" value="_OdDShEBz293_Sp-0djiAaDb66fA7NK3os4VMY_uInqpNGH7n7sdIKQfUj_RgisC7DP_lwV0odRituow2CQr8A" autocomplete="off" />
    <div class="hide-comments-modal__content">
      <p class="pb-2">
        Are you sure you want to hide this comment? It will become hidden in your post, but will still be visible via the comment's <a id="hide-comments-modal__comment-permalink" href="#">permalink</a>.
      </p>
      <label class="crayons-field crayons-field--checkbox my-2">
        <input name="hide_children" type="hidden" value="0" autocomplete="off" /><input class="hide_children crayons-checkbox" type="checkbox" value="1" name="hide_children" id="hide_children" />
        <p class="crayons-field__label">Hide child comments as well</p>
      </label>
      <p class="pb-4 pt-2">
        <button type="submit" class="crayons-btn">
          Confirm
        </button>
      </p>
    </div>
</form>  <p class="fs-s color-base-60">For further actions, you may consider blocking this person and/or <a id="hide-comments-modal__report-link" href="/report-abuse">reporting abuse</a></p>
</div>



      </article>

      <div class="pb-4 crayons-layout__comments-billboard">
        <div class="js-billboard-container pb-4 crayons-layout__comments-billboard" data-async-url="/kprotty/understanding-atomics-and-memory-ordering-2mom/billboards/post_comments"></div>
      </div>

          <section class="crayons-card crayons-card--secondary text-padding mb-4 print-hidden" id="bottom-content-read-next">
    <h2 class="crayons-subtitle-1">Read next</h2>
      <a href="/cxxgraph/revolutionizing-data-processing-with-cxxgraph-a-comprehensive-guide-to-graph-data-structures-in-c-3od5" data-preload-image="https://res.cloudinary.com/practicaldev/image/fetch/s--iB3SLlCO--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xo4vyesx3bs0m6o4ibuu.png" class="crayons-link mt-6 block">
        <div class="flex items-center">
          <span class="crayons-avatar crayons-avatar--xl m:crayons-avatar--2xl mr-4 shrink-0">
              <img loading="lazy" alt="zigrazor profile image" class="crayons-avatar__image" width="100" height="100" src="https://res.cloudinary.com/practicaldev/image/fetch/s--WoOptMtA--/c_imagga_scale,f_auto,fl_progressive,h_100,q_auto,w_100/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/670653/7d47f389-f8fa-4a78-b128-873c25d00bd4.png" />
          </span>
          <div>
            <h3 class="fs-xl mb-0 lh-tight">Revolutionizing Data Processing with CXXGraph: A Comprehensive Guide to Graph Data Structures in C++</h3>
            <p class="opacity-75 pt-1">
              ZigRazor - <time datetime="2023-03-28T09:54:35Z">Mar 28</time>
            </p>
          </div>
        </div>
      </a>
      <a href="/jimmymcbride/rust-vs-c-and-c-a-concise-comparison-for-developers-4l26" data-preload-image="https://res.cloudinary.com/practicaldev/image/fetch/s--Ma2eGWZ2--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/h97ulgime06sa78ekp7y.png" class="crayons-link mt-6 block">
        <div class="flex items-center">
          <span class="crayons-avatar crayons-avatar--xl m:crayons-avatar--2xl mr-4 shrink-0">
              <img loading="lazy" alt="jimmymcbride profile image" class="crayons-avatar__image" width="100" height="100" src="https://res.cloudinary.com/practicaldev/image/fetch/s--wFdrSEH1--/c_imagga_scale,f_auto,fl_progressive,h_100,q_auto,w_100/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/262904/ff7cff24-237b-45bb-b64e-27be6acc2355.png" />
          </span>
          <div>
            <h3 class="fs-xl mb-0 lh-tight">Rust vs C and C++: A Concise Comparison for Developers 🚀</h3>
            <p class="opacity-75 pt-1">
              Jimmy McBride - <time datetime="2023-03-25T15:07:25Z">Mar 25</time>
            </p>
          </div>
        </div>
      </a>
      <a href="/pratikparvati/design-pattern-builder-jcj" data-preload-image="https://res.cloudinary.com/practicaldev/image/fetch/s--ybXN9ij4--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/t1tg0snikrwpvo5h31rj.jpg" class="crayons-link mt-6 block">
        <div class="flex items-center">
          <span class="crayons-avatar crayons-avatar--xl m:crayons-avatar--2xl mr-4 shrink-0">
              <img loading="lazy" alt="pratikparvati profile image" class="crayons-avatar__image" width="100" height="100" src="https://res.cloudinary.com/practicaldev/image/fetch/s--IbFqiHNy--/c_imagga_scale,f_auto,fl_progressive,h_100,q_auto,w_100/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/628787/2820da37-5967-4c12-9347-97097b29f4ba.jpg" />
          </span>
          <div>
            <h3 class="fs-xl mb-0 lh-tight">Design Pattern - Builder</h3>
            <p class="opacity-75 pt-1">
              Pratik Parvati - <time datetime="2023-03-25T17:33:50Z">Mar 25</time>
            </p>
          </div>
        </div>
      </a>
      <a href="/codeninjausman/avl-tree-46o2" data-preload-image="https://res.cloudinary.com/practicaldev/image/fetch/s--YEdUbGOD--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/xu1mnzp6ce9olytbv1rf.png" class="crayons-link mt-6 block">
        <div class="flex items-center">
          <span class="crayons-avatar crayons-avatar--xl m:crayons-avatar--2xl mr-4 shrink-0">
              <img loading="lazy" alt="codeninjausman profile image" class="crayons-avatar__image" width="100" height="100" src="https://res.cloudinary.com/practicaldev/image/fetch/s--sGiI_M0f--/c_imagga_scale,f_auto,fl_progressive,h_100,q_auto,w_100/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/1029620/3fe0da39-bf80-4053-852e-0e575006e54a.jpg" />
          </span>
          <div>
            <h3 class="fs-xl mb-0 lh-tight">AVL Tree</h3>
            <p class="opacity-75 pt-1">
              Muhammad Usman - <time datetime="2023-03-24T05:38:33Z">Mar 24</time>
            </p>
          </div>
        </div>
      </a>
  </section>

    </div>
  </main>

  <aside class="crayons-layout__sidebar-right" aria-label="Author details">
    <div class="crayons-article-sticky grid gap-4 pb-4 break-word" id="article-show-primary-sticky-nav">
  <div class="crayons-card crayons-card--secondary branded-7 p-4 pt-0 gap-4 grid" style="border-top-color: #000000;">
    <div class="-mt-4">
  <a href="/kprotty" class="flex">
    <span class="crayons-avatar crayons-avatar--xl  mr-2 shrink-0">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ZKXQlQ-s--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/610982/4489bc94-50d9-4aa7-9364-e38f3d3d9258.jpeg" class="crayons-avatar__image" alt="" loading="lazy" />
    </span>
    <span class="crayons-link crayons-subtitle-2 mt-5">kprotty</span>
  </a>
</div>

<div class="print-hidden">
  <button name="button" type="button" data-info="{&quot;className&quot;:&quot;User&quot;,&quot;style&quot;:&quot;&quot;,&quot;id&quot;:610982,&quot;name&quot;:&quot;kprotty&quot;}" class="crayons-btn follow-action-button whitespace-nowrap w-100 follow-user" aria-label="Follow user: kprotty" aria-pressed="false">Follow</button>
</div>
  <div class="color-base-70">
    None
  </div>

  <div class="user-metadata-details">
    <ul class="user-metadata-details-inner">
        <li>
          <div class="key">
            Location
          </div>
          <div class="value">
            None 
          </div>
        </li>
      <li>
        <div class="key">
          Joined
        </div>
        <div class="value">
          <time datetime="2021-04-08T23:54:21Z" class="date">Apr 8, 2021</time>
        </div>
      </li>
    </ul>
  </div>

  </div>

      <div class="crayons-card crayons-card--secondary">
        <header class="crayons-card__header">
          <h3 class="crayons-subtitle-2">
            Trending on <a href="https://dev.to">DEV Community</a>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="24" height="24" role="img" aria-labelledby="as87bn84uzyyrgvg08xypircpscyzaud" class="crayons-icon crayons-icon--default"><title id="as87bn84uzyyrgvg08xypircpscyzaud">Hot</title>
    <g class="nc-icon-wrapper">
        <path fill="#F4900C" d="M39 23a16.96 16.96 0 00-1.04-5.868c-.46 5.389-3.333 8.157-6.335 6.868-2.812-1.208-.917-5.917-.777-8.164.236-3.809-.012-8.169-6.931-11.794 2.875 5.5.333 8.917-2.333 9.125-2.958.231-5.667-2.542-4.667-7.042-3.238 2.386-3.332 6.402-2.333 9 1.042 2.708-.042 4.958-2.583 5.208-2.84.28-4.418-3.041-2.963-8.333A16.936 16.936 0 005 23c0 9.389 7.611 17 17 17s17-7.611 17-17z"></path>
        <path fill="#FFCC4D" d="M32.394 27.999c.148 3.084-2.561 4.293-4.019 3.709-2.106-.843-1.541-2.291-2.083-5.291s-2.625-5.083-5.708-6c2.25 6.333-1.247 8.667-3.08 9.084-1.872.426-3.753-.001-3.968-4.007A11.964 11.964 0 0010 34c0 .368.023.73.055 1.09C13.125 38.124 17.342 40 22 40s8.875-1.876 11.945-4.91c.032-.36.055-.722.055-1.09 0-2.187-.584-4.236-1.606-6.001z"></path>
    </g>
</svg>

          </h3>
        </header>
        <div>
            <a class="crayons-link crayons-link--contentful flex" href="/anitaolsen/was-the-100daysofcode-a-great-challenge-for-you-2m5f">
              <span class="crayons-avatar mr-2 shrink-0">
                <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--YgsoCWUq--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/1195604/40b70c48-a204-4194-a6c0-6abd6a320615.jpg" class="crayons-avatar__image" loading="lazy" alt="Anita Olsen profile image">
              </span>
              <div>
                Was the #100DaysOfCode a Great Challenge for you?
                <div class="crayons-link__secondary -ml-1">
                    <span class="mr-1"><span class="opacity-50">#</span>discuss</span>
                    <span class="mr-1"><span class="opacity-50">#</span>100daysofcode</span>
                    <span class="mr-1"><span class="opacity-50">#</span>coding</span>
                    <span class="mr-1"><span class="opacity-50">#</span>codenewbie</span>
                </div>
              </div>
            </a>
            <a class="crayons-link crayons-link--contentful flex" href="/devteam/what-evening-habits-boost-productivity-466n">
              <span class="crayons-avatar mr-2 shrink-0">
                <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--T8ep-K_P--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/3/13d3b32a-d381-4549-b95e-ec665768ce8f.png" class="crayons-avatar__image" loading="lazy" alt="dev.to staff profile image">
              </span>
              <div>
                What Evening Habits Boost Productivity?
                <div class="crayons-link__secondary -ml-1">
                    <span class="mr-1"><span class="opacity-50">#</span>discuss</span>
                </div>
              </div>
            </a>
            <a class="crayons-link crayons-link--contentful flex" href="/drsavvina/the-dos-and-donts-of-resume-writing-how-to-create-a-professional-cv-40pl">
              <span class="crayons-avatar mr-2 shrink-0">
                <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--eIqOhVh4--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/138402/8207e556-9299-4164-b02b-c2336d545df7.png" class="crayons-avatar__image" loading="lazy" alt="Savvina Drougouti profile image">
              </span>
              <div>
                The Do’s and Don’ts of Resume Writing: How to Create a Professional CV
                <div class="crayons-link__secondary -ml-1">
                    <span class="mr-1"><span class="opacity-50">#</span>career</span>
                    <span class="mr-1"><span class="opacity-50">#</span>careerdevelopment</span>
                    <span class="mr-1"><span class="opacity-50">#</span>resume</span>
                    <span class="mr-1"><span class="opacity-50">#</span>jobsearch</span>
                </div>
              </div>
            </a>
        </div>
      </div>
</div>

<div class="crayons-article-sticky grid gap-4 break-word js-billboard-container" data-async-url="/kprotty/understanding-atomics-and-memory-ordering-2mom/billboards/post_sidebar"></div>

  </aside>
</div>


<div class="mod-actions-menu print-hidden"></div>
<div data-testid="unpublish-post-modal-container" class="unpublish-post-modal-container hidden"></div>
<div id="suspend-modal-content" class="hidden">
  <p>
    Once suspended, kprotty will not be able to comment or publish posts until their suspension is removed.
  </p>

  <div class="crayons-field mt-4">
    <label
      for="suspend-reason-userid-610982"
      class="crayons-field__label">
      Note:
    </label>
    <textarea
      id="suspend-reason-userid-610982"
      rows="4"
      cols="70"
      placeholder="Reason for suspension"
      class="crayons-textfield"
      aria-describedby="suspension-reason-error"
      required></textarea>
    <p
      id="suspension-reason-error"
      data-testid="suspension-reason-error"
      class="suspend-reason-error crayons-field__description"
      style="color: red;"
      aria-live="assertive">
    </p>
  </div>
  <div class="mt-4">
    <button
      id="submit-user-suspend-btn"
      class="c-btn c-btn--primary c-btn--destructive"
      data-btn-action="suspend"
      data-reason-selector="#suspend-reason-userid-610982"
      data-user-id="610982"
      data-username="kprotty">
      Submit &amp; Suspend
    </button>
  </div>
</div>

<div id="unsuspend-modal-content" class="hidden">
  <p>
    Once unsuspended, kprotty will be able to comment and publish posts again.
  </p>

  <div class="crayons-field mt-4">
    <label
      for="unsuspend-reason-userid-610982"
      class="crayons-field__label">
      Note:
    </label>
    <textarea
      id="unsuspend-reason-userid-610982"
      rows="4"
      cols="70"
      placeholder="Reason for unsuspension"
      class="crayons-textfield"
      aria-describedby="unsuspension-reason-error"
      required></textarea>
    <p
      id="unsuspension-reason-error"
      data-testid="unsuspension-reason-error"
      class="unsuspend-reason-error crayons-field__description"
      style="color: red;"
      aria-live="assertive">
    </p>
  </div>
  <div class="mt-4">
    <button
      id="submit-user-unsuspend-btn"
      class="c-btn c-btn--primary"
      data-btn-action="unsuspend"
      data-reason-selector="#unsuspend-reason-userid-610982"
      data-user-id="610982"
      data-username="kprotty">
      Submit &amp; Unsuspend
    </button>
  </div>
</div>

<div id="unpublish-all-posts" class="hidden">
  <p>
    Once unpublished, all posts by kprotty will become hidden and only accessible to themselves.
  </p>
  <p class="mt-2">
    If kprotty is not suspended, they can still re-publish their posts from their dashboard.
  </p>
  <p class="mt-2"><label for="note_content">Note:</label><textarea name="note[content]" id="note_content" class="crayons-textfield note_content" placeholder="Note text">
</textarea></p>
  <div class="mt-4">
    <button
      id="unpublish-all-posts-submit-btn"
      class="c-btn c-btn--destructive c-btn--primary"
      data-user-id="610982">
      Unpublish all posts
    </button>
  </div>
</div>

<div id="unpublish-post-modal" class="hidden">
  <p>
    Once unpublished, this post will become invisible to the public and only accessible to kprotty.
  </p>
  <p>They can still re-publish the post if they are not suspended.</p>
  <div class="mt-4">
    <button
      destructive
      variant="primary"
      class="c-btn c-btn--primary c-btn--destructive"
      id="confirm-unpublish-post-action">
      Unpublish Post
    </button>
  </div>
</div>

<div id="flag-user-modal-content" class="hidden">
  <p>
    Thanks for keeping DEV Community safe. Here is what you can do to flag kprotty:
  </p>

  <div class="crayons-field crayons-field--radio mt-4">
    <input
      type="radio"
      id="flag-user-radio-input"
      name="flag-user-radio-input"
      class="crayons-radio"
      data-reactable-id="610982"
      data-category="vomit"
      data-reactable-type="User" />
    <label for="flag-user-radio-input" class="crayons-field__label">
      Make all posts by kprotty less visible
      <p class="crayons-field__description">
        kprotty consistently posts content that violates DEV Community's
        code of conduct because it is harassing, offensive or spammy.
      </p>
    </label>
  </div>

  <div class="mt-4">
    <a
      href="javascript:void(0);"
      id="report-inappropriate-content"
      data-report-abuse-link="/report-abuse?url=https://dev.to/kprotty/understanding-atomics-and-memory-ordering-2mom">
      Report other inappropriate conduct
    </a>
  </div>

  <div class="mt-6">
    <p
      id="unselected-radio-error"
      data-testid="unselected-radio-error"
      class="crayons-field__description mb-4"
      style="color: red;"
      aria-live="assertive">
    </p>
    <button
      id="confirm-flag-user-action"
      class="c-btn c-btn--primary c-btn--destructive"
      data-category="vomit"
      data-reactable-type="User"
      data-user-id="610982"
      data-username="kprotty">
      Confirm Flag
    </button>
  </div>
</div>

<div id="unflag-user-modal-content" class="hidden">
  <p>
    Unflagging kprotty will restore default visibility to their posts.
  </p>

  <div class="mt-6">
    <button
      id="confirm-unflag-user-action"
      class="c-btn c-btn--primary"
      data-category="vomit"
      data-reactable-type="User"
      data-user-id="610982"
      data-username="kprotty">
      Confirm Unflag
    </button>
  </div>
</div>


<div class="fullscreen-code js-fullscreen-code"></div>
<script src="https://dev.to/packs/js/runtime~followButtons-56fe944952e8bb38b6eb.js" defer="defer"></script>
<script src="https://dev.to/packs/js/5-4570d4bfbce73a76f0c4.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/followButtons-09ffcbdecdaeb5b0cb92.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/runtime~billboard-3831a809b3ffb1e69d79.js" defer="defer"></script>
<script src="https://dev.to/packs/js/billboard-773a14247f4df3121de1.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/runtime~localizeArticleDates-c8de004717960056e0d5.js" defer="defer"></script>
<script src="https://dev.to/packs/js/localizeArticleDates-e6a322e06ef008478070.chunk.js" defer="defer"></script>
<script src="https://dev.to/packs/js/runtime~articleReactions-b487e7b7895dc5460261.js" defer="defer"></script>
<script src="https://dev.to/packs/js/articleReactions-a5ae84e1fed22322fda4.chunk.js" defer="defer"></script>

<script>
  var waitingOnPodcast = setInterval(function() {
  if (typeof initializePodcastPlayback !== 'undefined') {
    initializePodcastPlayback();
    clearInterval(waitingOnPodcast);
  }
}, 1);

  if (document.head.querySelector('meta[name="user-signed-in"][content="true"]')) {
  function displayPollResults(json) {
    var totalVotes = json.voting_data.votes_count;
    json.voting_data.votes_distribution.forEach(function(point) {
      var pollOptionItem = document.getElementById('poll_option_list_item_'+point[0]);
      var optionText = document.getElementById('poll_option_label_'+point[0]).textContent;
      if (json.user_vote_poll_option_id === point[0]) {
        var votedClass = 'optionvotedfor'
      } else {
        var votedClass = 'optionnotvotedfor'
      }
      if (totalVotes === 0) {
        var percent = 0;
      } else {
        var percent = (point[1]/totalVotes)*100;
      }
      var roundedPercent = Math.round( percent * 10 ) / 10
      var percentFromRight = (100-roundedPercent)
      var html = '<span><span class="ltag-votepercent ltag-'+votedClass+'" style="right:'+percentFromRight+'%"></span>        <span class="ltag-votepercenttext">'+optionText+' — '+roundedPercent+'%</span></span>';
      pollOptionItem.innerHTML = html;
      pollOptionItem.classList.add('already-voted')
      document.getElementById('showmethemoney-'+json.poll_id).innerHTML = '<span class="ltag-voting-results-count">'+totalVotes+' total votes</span>';
    })
  }

  var polls = document.getElementsByClassName('ltag-poll');
  for (var i = 0; i < polls.length; i += 1) {
    var poll = polls[i]
    var pollId = poll.dataset.pollId
    window.fetch('/poll_votes/'+pollId)
    .then(function(response){
      response.json().then(
        function(json) {
          if (json.voted) {
            displayPollResults(json)
          } else {
            var els = document.getElementById('poll_'+json.poll_id).getElementsByClassName('ltag-polloption');

            for (i = 0; i < els.length; i += 1) {
              els[i].addEventListener('click', function(e) {
                var tokenMeta = document.querySelector("meta[name='csrf-token']")
                if (!tokenMeta) {
                  alert('Whoops. There was an error. Your vote was not counted. Try refreshing the page.')
                  return
                }
                var csrfToken = tokenMeta.getAttribute('content')
                var optionId = e.target.dataset.optionId
                window.fetch('/poll_votes', {
                  method: 'POST',
                  headers: {
                    'X-CSRF-Token': csrfToken,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({poll_vote: { poll_option_id: optionId } }),
                  credentials: 'same-origin',
                }).then(function(response){
                  response.json().then(function(j){displayPollResults(j)})
                })
              });
            }

            document.getElementById('showmethemoney-'+json.poll_id).addEventListener('click', function() {
              pollId = this.dataset.pollId
              window.fetch('/poll_skips', {
                method: 'POST',
                headers: {
                  'X-CSRF-Token': csrfToken,
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({poll_skip: {poll_id: pollId }}),
                credentials: 'same-origin',
              }).then(function(response){
                response.json().then(function(j){displayPollResults(j)})
              })
            });
          }
        }
      )
    })
  }
} else {
    var els = document.getElementsByClassName('ltag-poll')
    for (i = 0; i < els.length; i += 1) {
      els[i].onclick = function(e) {
        if (typeof showLoginModal !== "undefined") {
          showLoginModal();
        }
      }
    }
}

  function activateRunkitTags() {
  if (!areAnyRunkitTagsPresent())
    return

  var checkRunkit = setInterval(function() {
    try {
      dynamicallyLoadRunkitLibrary()

      if (typeof(RunKit) === 'undefined') {
        return
      }

      replaceTagContentsWithRunkitWidget()
      clearInterval(checkRunkit);
    } catch(e) {
      console.error(e);
      clearInterval(checkRunkit);
    }
  }, 200);
}

function isRunkitTagAlreadyActive(runkitTag) {
  return runkitTag.querySelector("iframe") !== null;
};

function areAnyRunkitTagsPresent() {
  var presentRunkitTags = document.getElementsByClassName("runkit-element");

  return presentRunkitTags.length > 0
}

function replaceTagContentsWithRunkitWidget() {
  var targets = document.getElementsByClassName("runkit-element");
  for (var i = 0; i < targets.length; i++) {
    if (isRunkitTagAlreadyActive(targets[i])) {
      continue;
    }

    var wrapperContent = targets[i].textContent;
    if (/^(<iframe src)/.test(wrapperContent) === false) {
      if (targets[i].children.length > 0) {
        var preamble = targets[i].children[0].textContent;
        var content = targets[i].children[1].textContent;
        targets[i].innerHTML = "";
        var notebook = RunKit.createNotebook({
          element: targets[i],
          source: content,
          preamble: preamble
        });
      }
    }
  }
};

function dynamicallyLoadRunkitLibrary() {
  if (typeof(dynamicallyLoadScript) === "undefined")
    return

  dynamicallyLoadScript("//embed.runkit.com")
}

activateRunkitTags();

    // Listen for resize events and match them to the iframe
  window.addEventListener('message', function(event) {
    if (event.origin.startsWith('https://platform.twitter.com')) {
        var iframes = document.getElementsByTagName('iframe');
        for (var i = 0; i < iframes.length; i++) {
          if (event.source === iframes[i].contentWindow) { // iframes which match the event
            var iframe = iframes[i];
            var data = event.data['twttr.embed'];
            if (data && data['method'] === 'twttr.private.resize' && data['params'] && data['params']['0']) {
              iframe.style.height = data['params']['0']['height'] + 0.5 + 'px';
              iframe.style.minHeight = data['params']['0']['height'] + 0.5 + 'px';
              iframe.style.width = data['params']['0']['width'] + 'px !important';
            }
            break;
          }
        }
    }
}, false);

// Legacy support: We have shifted up how we render tweets, but still need to render
// the old way for old embed. This could eventually be removed.
var videoPreviews = document.getElementsByClassName("ltag__twitter-tweet__media__video-wrapper");
[].forEach.call(videoPreviews, function(el) {
  el.onclick = function(e) {
    var divHeight = el.offsetHeight;
    el.style.maxHeight = divHeight + "px";
    el.getElementsByClassName("ltag__twitter-tweet__media--video-preview")[0].style.display = "none";
    el.getElementsByClassName("ltag__twitter-tweet__video")[0].style.display = "block";
    el.getElementsByTagName("video")[0].play();
  }
});
var tweets = document.getElementsByClassName("ltag__twitter-tweet__main");
[].forEach.call(tweets, function(tweet){
  tweet.onclick = function(e) {
    if (e.target.nodeName == "A" || e.target.parentElement.nodeName == "A") {
      return;
    }
    window.open(tweet.dataset.url,"_blank");
  }
});

</script>

    <div id="runtime-banner-container"></div>
  </div>
</div>
    
<footer id="footer" class="crayons-footer print-hidden">
  <div id="footer-container" class="crayons-footer__container">
    <p class="fs-s crayons-footer__description">
      <a class="c-link c-link--branded fw-medium" aria-label="DEV Community Home" href="/">DEV Community</a> — A constructive and inclusive social network for software developers. With you every step of your journey.
    </p>

    <ul class="footer__nav-links flex gap-2 justify-center flex-wrap fs-s p-0" style="" />
        <li class="footer__nav-link flex items-center">
    <a href="/">
      Home
    </a>
    <span class="dot ml-2"></span>
  </li>
  <li class="footer__nav-link flex items-center">
    <a href="/pod">
      Podcasts
    </a>
    <span class="dot ml-2"></span>
  </li>
  <li class="footer__nav-link flex items-center">
    <a href="/videos">
      Videos
    </a>
    <span class="dot ml-2"></span>
  </li>
  <li class="footer__nav-link flex items-center">
    <a href="/tags">
      Tags
    </a>
    <span class="dot ml-2"></span>
  </li>
  <li class="footer__nav-link flex items-center">
    <a href="/faq">
      FAQ
    </a>
    <span class="dot ml-2"></span>
  </li>
  <li class="footer__nav-link flex items-center">
    <a href="https://shop.forem.com/">
      Forem Shop
    </a>
    <span class="dot ml-2"></span>
  </li>
  <li class="footer__nav-link flex items-center">
    <a href="/advertise">
      Advertise on DEV
    </a>
    <span class="dot ml-2"></span>
  </li>
  <li class="footer__nav-link flex items-center">
    <a href="/about">
      About
    </a>
    <span class="dot ml-2"></span>
  </li>
  <li class="footer__nav-link flex items-center">
    <a href="/contact">
      Contact
    </a>
    <span class="dot ml-2"></span>
  </li>
  <li class="footer__nav-link flex items-center">
    <a href="/guides">
      Guides
    </a>
    <span class="dot ml-2"></span>
  </li>
  <li class="footer__nav-link flex items-center">
    <a href="/software-comparisons">
      Software comparisons
    </a>
    <span class="dot ml-2"></span>
  </li>

    </ul>

    <ul class="footer__nav-links flex gap-2 justify-center flex-wrap fs-s p-0" style="" />
        <li class="footer__nav-link flex items-center">
    <a href="/code-of-conduct">
      Code of Conduct
    </a>
    <span class="dot ml-2"></span>
  </li>
  <li class="footer__nav-link flex items-center">
    <a href="/privacy">
      Privacy Policy
    </a>
    <span class="dot ml-2"></span>
  </li>
  <li class="footer__nav-link flex items-center">
    <a href="/terms">
      Terms of use
    </a>
    <span class="dot ml-2"></span>
  </li>

    </ul>

    <div class="fs-s">
      <p>Built on <a class="c-link c-link--branded" target="_blank" rel="noopener" href="https://www.forem.com">Forem</a> — the <a target="_blank" rel="noopener" class="c-link c-link--branded" href="https://dev.to/t/opensource">open source</a> software that powers <a target="_blank" rel="noopener" class="c-link c-link--branded" href="https://dev.to">DEV</a> and other inclusive communities.</p>
      <p>Made with love and <a target="_blank" rel="noopener" class="c-link c-link--branded" href="https://dev.to/t/rails">Ruby on Rails</a>. DEV Community <span title="copyright">&copy;</span> 2016 - 2023.</p>
    </div>
  </div>
</footer>
<div id="snack-zone"></div>

    <div id="global-signup-modal" class="authentication-modal hidden">
  <div class="authentication-modal__container">
    <figure class="authentication-modal__image-container">
      <img class="authentication-modal__image" src="https://res.cloudinary.com/practicaldev/image/fetch/s--7zXAI5wW--/c_limit,f_auto,fl_progressive,q_80,w_190/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8j7kvp660rqzt99zui8e.png"
        alt="DEV Community" loading="lazy" />
    </figure>
    <div class="authentication-modal__content">
      <p class="authentication-modal__description">
          We&#39;re a place where coders share, stay up-to-date and grow their careers.
      </p>
    </div>
    <div class="authentication-modal__actions">
      <a href="/enter" class="crayons-btn" aria-label="Log in" data-no-instant>
        Log in
      </a>
      <a href="/enter?state=new-user" class="crayons-btn crayons-btn--ghost-brand js-global-signup-modal__create-account" aria-label="Create new account" data-no-instant>
        Create account
      </a>
    </div>
  </div>
</div>

<script src="https://dev.to/packs/js/runtime~signupModalShortcuts-29650e29e13fb842bf33.js" defer="defer"></script>
<script src="https://dev.to/packs/js/signupModalShortcuts-dd79ac925a0a777eb600.chunk.js" defer="defer"></script>

  <div id="i18n-translations" data-translations="{&quot;en&quot;:{&quot;core&quot;:{&quot;add_comment&quot;:&quot;Add comment&quot;,&quot;beta&quot;:&quot;beta&quot;,&quot;comment&quot;:&quot;Comment&quot;,&quot;copy_link&quot;:&quot;Copy link&quot;,&quot;edit_profile&quot;:&quot;Edit profile&quot;,&quot;follow&quot;:&quot;Follow&quot;,&quot;follow_back&quot;:&quot;Follow back&quot;,&quot;following&quot;:&quot;Following&quot;,&quot;like&quot;:&quot;Like&quot;,&quot;loading&quot;:&quot;loading...&quot;,&quot;reaction&quot;:&quot;Reaction&quot;,&quot;report_abuse&quot;:&quot;Report abuse&quot;,&quot;search&quot;:&quot;Search&quot;,&quot;success_settings&quot;:&quot;Successfully updated settings.&quot;,&quot;counted_organization&quot;:{&quot;one&quot;:&quot;%{count} organization&quot;,&quot;other&quot;:&quot;%{count} organizations&quot;},&quot;counted_user&quot;:{&quot;one&quot;:&quot;%{count} person&quot;,&quot;other&quot;:&quot;%{count} people&quot;},&quot;not_following&quot;:&quot;You&#39;re not following anyone&quot;,&quot;following_everyone&quot;:&quot;You&#39;re following %{details} (everyone)&quot;,&quot;you_are_following&quot;:&quot;You&#39;re following&quot;,&quot;and&quot;:&quot;and&quot;}}}"></div>
  <div id="reaction-category-resources" class="hidden" aria-hidden="true">
    <img data-name="Like" data-slug="like" data-position="1" src="https://dev.to/assets/sparkle-heart-5f9bee3767e18deb1bb725290cb151c25234768a0e9a2bd39370c382d02920cf.svg" width="18" height="18" />
    <img data-name="Unicorn" data-slug="unicorn" data-position="2" src="https://dev.to/assets/multi-unicorn-b44d6f8c23cdd00964192bedc38af3e82463978aa611b4365bd33a0f1f4f3e97.svg" width="18" height="18" />
    <img data-name="Exploding Head" data-slug="exploding_head" data-position="3" src="https://dev.to/assets/exploding-head-daceb38d627e6ae9b730f36a1e390fca556a4289d5a41abb2c35068ad3e2c4b5.svg" width="18" height="18" />
    <img data-name="Raised Hands" data-slug="raised_hands" data-position="4" src="https://dev.to/assets/raised-hands-74b2099fd66a39f2d7eed9305ee0f4553df0eb7b4f11b01b6b1b499973048fe5.svg" width="18" height="18" />
    <img data-name="Fire" data-slug="fire" data-position="5" src="https://dev.to/assets/fire-f60e7a582391810302117f987b22a8ef04a2fe0df7e3258a5f49332df1cec71e.svg" width="18" height="18" />
</div>

  </body>
  </html>
